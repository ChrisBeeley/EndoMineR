---
title: "Template Script for GRS reports"
author: "Sebastian Zeki"
date: "20/11/2018"
output: html_document
---

## Title and abstract

**Study Design**

Remember to use **PICO**

**1.Patient population**

#In patients being investigated for GORD with a negative pH impedance study 

**2.Intervention**

#who go on to have a BRAVO study

**3.Comparison**

Is there a significant increase between the two tests

**4.Outcome**

in the patients who have GORD

**5. Further**

What can predict a BRAVO positive, pH impedance negative investigation to support a Straight-to-BRAVO test?



**Diagnosis** a) In patients being investigated for GORD with a negative impedance study for GORD who go on to have a BRAVO study, what proportion have a positive BRAVO for GORD condition


**$\color{red}{\text{A.Indicate the study’s design with a commonly used term in the title or the abstract}}$.**

**Example 1**

Title: ‘An observational study with long-term follow-up of canine cognitive dysfunction: Clinical characteristics, survival
and risk factors’ (Fast et al., 2013).

Example 2
Title: ‘Case-control study of risk factors associated with Brucella melitensis on goat farms in Peninsular Malaysia’ (Bamaiyi et al., 2014).

**Explanation **
Including the study design term in the title or abstract when a standard study design is used, or at least identifying that a study is observational, allows the reader to easily identify the design and helps to ensure that articles are correctly indexed in electronic databases (Benson and Hartz, 2000). In STROBE, item 1a only requests that a common study design term be used. However, in veterinary research, not all observational studies are easily categorized into cohort, case–control, or cross-sectional study designs. Therefore, we recommend including that the study was observational and, if possible, the study design or important design characteristics, for example longitudinal, in the title.


---
title: "Template for STROBE presentation at conference abstracts"
author: "Sebastian Zeki"
date: "04/09/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

**$\color{red}{\text{B.Introductory sentence 1: Define the disease condition}}$.**

**eg** Aperistaltic oesophagus is a term that covers all conditions where achalasia is absent and there is no peristaltic activity

**$\color{red}{\text{C.Introductory sentence 2: The overview of the disease condition}}$.**

**eg** Aperistaltic oesophagus remains a difficult condition to treat with no specific and effective treatments

**$\color{red}{\text{D.Introductory sentence 3: The problem being addressed}}$.**

**eg** The number of non-achalasia aperistaltic oesophagus patients is unknown.

**eg** Although often isolated from outpatients in veterinary clinics, there is concern that MRSP follows a veterinary-hospital associated epidemiology


```{r Introduction}

```

## Aim


**eg** The aim of the study was to assess the number of patients with aperistaltic oesophagus without achalasia and ascertain their demographics


```{r Aim}
```



## Methods


**$\color{red}{\text{E.Define the Dates}}$.**

Get the dates from the minimum of the VisitDate column `r 1+1 `

**$\color{red}{\text{F.Define the Location}}$.**
Standard sentence here about GSTT
The results of high resolution studies performed in patients with cough as part of the presenting complaint to the gastroenterology service at Guy's and St Thomas' NHS Trust were examined retrospectively between June 2008 and January 2018. 

**$\color{red}{\text{F.Define the Eligibility}}$.**
All patients selected were adults over the age of 18. Ethics was approved (IRAS number) and by the local ethics board.

**$\color{red}{\text{F.Define the Exclusion}}$.**
Patients with incomplete data sets were exluded from the study. Where x was not available fromt the report, the raw file was located and manually analysed

**$\color{red}{\text{G.Define the Sampling}}$.**

Patients were selected according to Chicago Classification v3. Patients symptoms were selected from self reporting at impedance if this was done at the same time as high resolution manometry. If this was not the case then the symptoms were extracted either from the final report summarising the patient's condition and physiological diagnosis, or from the clinicians details when ordering the investigation.

**$\color{red}{\text{H.Define the data cleaning methodology methods}}$.**

This involves how the relevant columns were accordionised (eg categorising the patients/and how subgroups were formed).



```{r Acquisition}
library(EndoMineR)
library(tidyverse)



######################################### Data acquisiton######################################### 
#Just from TheOGDReportFinal
#Data sources
data(TheOGDReportFinal)
data(PathDataFrameFinal)

```
  
  
  
  
  
  
```{r Prep}

######################################### Data cleaning & Data merging######################################### 
#Now all the text preparation functions

#Prepare the text for OGD
mywordsOGD<-c("hospital number:","patient name:","general practitioner","date of procedure:","endoscopist:","2nd endoscopist:","medications:","instrument:","extent of exam:","indications:", "procedure performed:","findings:","diagnosis:")
MyOGD<-textPrep(TheOGDReportFinal$OGDReportWhole,mywordsOGD)


#Prepare the text for Pathology
mywordsPath<-c("hospital number:","patient name:","dob:","general practitioner:","date received:","nature of specimen:","macroscopic description:" ,"diagnosis:")
MyPath<-textPrep(PathDataFrameFinal$PathReportWhole,mywordsPath)


```






```{r Merge}
#########################################  Data merging ######################################### 
#Now merge the two
FinalDataset<-Endomerge2(MyOGD,"dateofprocedure","hospitalnumber",MyPath,"datereceived","hospitalnumber")

```





```{r Clean}

#########################################  Data cleaning ######################################### 


#Now all the cleaning functions. Firstly endoscopy
FinalDataset$endoscopist<-EndoscEndoscopist(FinalDataset$endoscopist)
#Clean the meds (need to bind to the existing dataframe)
FinalDataset<-cbind(EndoscMeds(FinalDataset$medications),FinalDataset)
FinalDataset$instrument<-EndoscInstrument(FinalDataset$instrument)
```








```{r Extrapolate1- calculated and keyword}
######################################### Data accordionisation######################################### 
#Now extrapolation with histology
FinalDataset$NumBx<-HistolNumbOfBx(FinalDataset$macroscopicdescription,'specimen')
FinalDataset$BxSize<-HistolBxSize(FinalDataset$macroscopicdescription)
 HistolTypeAndSiteToJoin<-HistolTypeAndSite(FinalDataset$procedureperformed,FinalDataset$macroscopicdescription,FinalDataset$Original.x)
FinalDataset<-cbind(FinalDataset,HistolTypeAndSiteToJoin)

#This one needs some attention- why is there a discrepancy between the dataset and the number of rows? Something wrong with the unlisting here.
#Probably needs a paste collapse first- maybe even as part of the function itself
```







```{r Extrapolate2- colocation}
#Colocation extrapolation
#FinalDataset$EndoscopyEvent<-unlist(EntityPairs_TwoSentence(FinalDataset$findings,LocationList(),EventList()))
FinalDataset$EndoscopyEvent<-EndoscopyEvent(FinalDataset,"findings","procedureperformed","macroscopicdescription","Original.x")

#Temporal colocation. As an example, with histology. This requires udpipe to be downloaded as can't have it as part of the function:
FinalDataset$Temporal<-Temporal(FinalDataset$findings)

```

```{r Disease1-Barretts}
######################################### Disease specific functions ######################################### 

FinalDatasetBarr<-Barretts_PragueScore(FinalDataset,'findings','Original.x')
FinalDatasetBarr$IMorNoIM<-Barretts_PathStage(FinalDatasetBarr,"Original.x")
FinalDatasetBarr$FUType<-Barretts_FUType(FinalDatasetBarr,"CStage","MStage","IMorNoIM")
FinalDatasetBarr$Paris<-BarrettsParisEMR(FinalDatasetBarr$procedureperformed,FinalDatasetBarr$findings)
BarrettsBxQual2<-BarrettsBxQual(FinalDatasetBarr,'Date.x','pHospitalNum','endoscopist')



######################################### Data forking (filtering and subsetting) #########################
#Now frame the question you are interested in and develop subsets
```

```{r Generic Analyses}
FinalDatasetBarr<-SurveilTimeByRow(FinalDatasetBarr,'pHospitalNum','Date.x')

#Gives you all the last tests done:
LastTestsDone<-SurveilLastTest(FinalDatasetBarr,'pHospitalNum','Date.x')
FirstTestsDone<-SurveilFirstTest(FinalDatasetBarr,'pHospitalNum','Date.x')

#Need to sort this one out

ff<-HowManyOverTime(FinalDatasetBarr,'indications','Date.x','.*')

```


```{r DataAnalysis}





```

```{r DataViz}




```

```{r VarDiagram}
#### Documenting the sets 

nodes <- create_node_df(n=6, 
                        nodes=c("ImpAll", "AllBravo", "NegativeImpedance","MyBravoFromNegativeImpedance","MyBravoFromNegativeImpedancePOSITIVE_BRAVO","MyBravoFromNegativeImpedanceNEGATTIVE_BRAVO"),
                        label=c(paste0("ImpAll: ",nrow(ImpAll)), stringr::str_wrap(paste0("All BRAVO: ",nrow(AllBravo)),10), stringr::str_wrap(paste0("Negative Impedance: ",nrow(NegativeImpedance)),10),
                                stringr::str_wrap(paste0("MyBravo (Negative Impedance):",nrow(MyBravoFromNegativeImpedance)),10),
                                stringr::str_wrap(paste0("Positive BRAVO:",nrow(MyBravoFromNegativeImpedancePOSITIVE_BRAVO)),10),
                                stringr::str_wrap(paste0("Negative BRAVO: ",nrow(MyBravoFromNegativeImpedanceNEGATTIVE_BRAVO)),10)),
                        shape = "rectangle",
                        fontsize=5)

edges <-
  create_edge_df(
    from = c(1,2,3,4,4),
    to = c(3,4,4,5,6))


g <- create_graph(nodes_df=nodes, 
                  edges_df=edges)%>%
   add_global_graph_attrs(
      attr = c("layout", "rankdir", "splines"),
      value = c("dot", "TB", "false"),
      attr_type = c("graph", "graph", "graph"))
render_graph(g)

```

```{r CodeGraph}
####Documenting the code: 

# library(CodeDepends)
# sc = readScript("/home/rstudio/PhysiMineR/Questions/ImpedanceQues/NegImpBRAVO/NegativeImpedanceBRAVO.Rmd")
# g = makeVariableGraph( info =getInputs(sc))
# if(require(Rgraphviz))
#   edgemode(g) <- "directed"
# x <- layoutGraph(g, layoutType="neato")
# zz = layoutGraph(g)
# graph.par(list(nodes = list(fontsize = 100)))
# renderGraph(zz)


```

## Results


**$\color{red}{\text{I.Define the Statistical methods}}$.**

**eg** Clinical isolates of MRSP cases (n = 150) and methicillin-susceptible S. pseudintermedius (MSSP) controls (n = 133) and their corresponding host signalment and medical data covering the six months prior to staphylococcal isolation were analysed by multivariable logistic regression.

The identity of all MRSP isolates was confirmed through demonstration of S. intermedius-group specific nuc and mecA.

**$\color{red}{\text{I.Describe demographics}}$.**
The mean age was 57.3 ± 17 years, and 62.3% of the subjects were male. 
The age-adjusted incidence rates were 13.8 (non-lobar) and 4.9 (lobar) per 100,000 person-years.
**$\color{red}{\text{J.Then describe level one results}}$.**

**$\color{red}{\text{K.Then describe subset results}}$.**

**eg** In the final model, cats (compared to dogs, OR 18.5, 95% CI 1.8–188.0, P = 0.01), animals that had been
hospitalised (OR 104.4, 95% CI 21.3–511.6, P < 0.001), or visited veterinary clinics more frequently (>10 visits
OR 7.3, 95% CI 1.0–52.6, P = 0.049) and those that had received topical ear medication (OR 5.1, 95% CI 1.8–
14.9, P = 0.003) or glucocorticoids (OR 22.5, 95% CI 7.0–72.6, P < 0.001) were at higher risk of MRSP infection,
whereas S. pseudintermedius isolates from ears were more likely to belong to the MSSP group (OR 0.09, 95%
CI 0.03–0.34, P < 0.001).

**Choose your statistical analysis**


```{r Results}
######################################### Data analysis######################################### 




```

## Discussion

**$\color{red}{\text{L.Sentence 1: To be decided}}$.**

**$\color{red}{\text{M.Sentence 2: To be decided}}$.**

**$\color{red}{\text{N.Sentence 3: To be decided}}$.**
**eg** These results indicate an association of MRSP infection with veterinary clinic/hospital
settings and possibly with chronic skin disease.


```{r Discussion}
```

## Limitations
**$\color{red}{\text{O.Sentence 1: To be decided}}$.**
**eg** There was an unexpected lack of association between MRSP and antimicrobial therapy; this requires further investigation .(Lehner et al., 2014).

```{r Limitations}
```

