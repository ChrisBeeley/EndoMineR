<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysis • EndoMineR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">EndoMineR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/EndoMineRPrinciples.html">EndoMineR Principles</a>
    </li>
    <li>
      <a href="../articles/EndoMineR.html">Package overview</a>
    </li>
    <li>
      <a href="../articles/Analysis.html">Analysis</a>
    </li>
    <li>
      <a href="../articles/Barretts.html">Barrett's</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://gastrodatascience.com">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Analysis</h1>
                        <h4 class="author">Sebastian Zeki</h4>
            
            <h4 class="date">12/22/2017</h4>
          </div>

    
    
<div class="contents">
<div id="the-analysis-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#the-analysis-functions" class="anchor"></a>The Analysis Functions</h2>
<p>The analysis functions are split according to the cornerstone questions in day to day gastroenterological practice. These cornerstone questions are expanded upone in the Principles section. In brief they include Surveillance and patient tracking, Endoscopic and Pathology quality and patient flow questions.</p>
<div id="surveillance-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#surveillance-functions" class="anchor"></a>Surveillance functions</h3>
<p>Surveillance relates to the timing of a test relative to other tests or all tests done for a patient. As such the functions for surveillance extract the date the first test was done, as well as the last test and the difference in timing between each test, always grouped by patient. As all these functions are simply looking at the date of the test they can take a raw dataset, as long as a date column is present and use that, rather than have a lot of pre-processing steps. How the data is organised is explained in the Principles section but essentially the details of this are all hidden in the function.</p>
<p><br></p>
<p><img src="img/EndoMineR_Surveillance.svg" style="display: block; margin: auto;"></p>
<p><br></p>
<p>The basic surveillance functions are simple but are the most often used. SurveillanceTimeByRow will extract the time difference between each individual endoscopy for an individual patient. This is useful to see how adherent the surveillance endoscopy is to guidelines. SurveilLastToNow will show the time difference between now and the last endoscope the patient had. This can be useful to determine if a patient is overdue a further endoscopy. SurveilLastTest simply extracts the last and first test respectively for each patient.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em1&lt;-<span class="kw"><a href="../reference/SurveilTimeByRow.html">SurveilTimeByRow</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)
<span class="kw">pander</span>(<span class="kw">head</span>(<span class="kw">data.frame</span>(em1[<span class="dv">2</span>],em1[<span class="kw">ncol</span>(em1)]),<span class="dv">5</span>))</code></pre></div>
<table style="width:39%;" class="table">
<colgroup>
<col width="23%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">diffDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">A1648588</td>
<td align="center">-521 days</td>
</tr>
<tr class="even">
<td align="center">A1648588</td>
<td align="center">-170 days</td>
</tr>
<tr class="odd">
<td align="center">A1648588</td>
<td align="center">-400 days</td>
</tr>
<tr class="even">
<td align="center">A1648588</td>
<td align="center">-161 days</td>
</tr>
<tr class="odd">
<td align="center">A1648588</td>
<td align="center">-510 days</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em2&lt;-<span class="kw"><a href="../reference/SurveilLastToNow.html">SurveilLastToNow</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)
<span class="kw">pander</span>(<span class="kw">head</span>(<span class="kw">data.frame</span>(em2[<span class="dv">2</span>],em2[<span class="kw">ncol</span>(em2)]),<span class="dv">5</span>))</code></pre></div>
<table style="width:38%;" class="table">
<colgroup>
<col width="23%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">diffDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">A1648588</td>
<td align="center">800 days</td>
</tr>
<tr class="even">
<td align="center">A1648588</td>
<td align="center">800 days</td>
</tr>
<tr class="odd">
<td align="center">A1648588</td>
<td align="center">800 days</td>
</tr>
<tr class="even">
<td align="center">A1648588</td>
<td align="center">800 days</td>
</tr>
<tr class="odd">
<td align="center">A1648588</td>
<td align="center">800 days</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em3&lt;-<span class="kw"><a href="../reference/SurveilLastTest.html">SurveilLastTest</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)
<span class="kw">pander</span>(<span class="kw">head</span>(<span class="kw">data.frame</span>(em3[<span class="dv">2</span>],em3[<span class="dv">5</span>]),<span class="dv">5</span>))</code></pre></div>
<table style="width:47%;" class="table">
<colgroup>
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">Dateofprocedure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J1337672</td>
<td align="center">2013-03-25</td>
</tr>
<tr class="even">
<td align="center">Q7176341</td>
<td align="center">2014-05-31</td>
</tr>
<tr class="odd">
<td align="center">M5148114</td>
<td align="center">2014-06-18</td>
</tr>
<tr class="even">
<td align="center">Q7729897</td>
<td align="center">2014-07-19</td>
</tr>
<tr class="odd">
<td align="center">R3882435</td>
<td align="center">2014-11-15</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em4&lt;-<span class="kw"><a href="../reference/SurveilFirstTest.html">SurveilFirstTest</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)
<span class="kw">pander</span>(<span class="kw">head</span>(<span class="kw">data.frame</span>(em4[<span class="dv">2</span>],em4[<span class="dv">5</span>]),<span class="dv">5</span>))</code></pre></div>
<table style="width:47%;" class="table">
<colgroup>
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">Dateofprocedure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">F7957976</td>
<td align="center">2001-01-03</td>
</tr>
<tr class="even">
<td align="center">Y8594667</td>
<td align="center">2001-01-04</td>
</tr>
<tr class="odd">
<td align="center">Z6299612</td>
<td align="center">2001-01-08</td>
</tr>
<tr class="even">
<td align="center">R8004923</td>
<td align="center">2001-01-15</td>
</tr>
<tr class="odd">
<td align="center">U1759838</td>
<td align="center">2001-01-16</td>
</tr>
</tbody>
</table>
<p>Of course we also want to know how many tests have been done over a time period and this is provided by two functions</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em5&lt;-<span class="kw"><a href="../reference/SurveilCapacity.html">SurveilCapacity</a></span>(Myendo,<span class="st">"Dateofprocedure"</span>)
<span class="kw">pander</span>(<span class="kw">head</span>(em5))</code></pre></div>
<table style="width:18%;" class="table">
<colgroup>
<col width="11%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="center">month</th>
<th align="center">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">01</td>
<td align="center">178</td>
</tr>
<tr class="even">
<td align="center">02</td>
<td align="center">158</td>
</tr>
<tr class="odd">
<td align="center">03</td>
<td align="center">174</td>
</tr>
<tr class="even">
<td align="center">04</td>
<td align="center">146</td>
</tr>
<tr class="odd">
<td align="center">05</td>
<td align="center">184</td>
</tr>
<tr class="even">
<td align="center">06</td>
<td align="center">170</td>
</tr>
</tbody>
</table>
<p>This function will return the number of tests by month. The more detailed function is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">how&lt;-<span class="kw"><a href="../reference/HowManyTests.html">HowManyTests</a></span>(Myendo,<span class="st">'Indications'</span>,<span class="st">'Dateofprocedure'</span>,<span class="st">'Surv'</span>)
how[<span class="dv">1</span>]</code></pre></div>
<pre><code>## $Myplot</code></pre>
<p><img src="Analysis_files/figure-html/exampleHowManyTests-1.png" width="672"></p>
<p>This will provide the number of tests by month and year as a table as well as a ggplot. It returns a list containing both the ggplot and a dataframe so this can be accessed with how[1] and how[2]</p>
</div>
<div id="patient-flow-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#patient-flow-functions" class="anchor"></a>Patient flow functions</h3>
<div id="sankey-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#sankey-plots" class="anchor"></a>Sankey plots</h4>
<p>We often like to get an overview of how patients are flowing through a system overall. This can give a nice visual representation of whether which patients diverge from the normal flow through a system so we can study them further. There are two ways to look at this. Sankey plots give good timepoint by timepoint representation of flow. This really works with more than one type of event at each timepoint. For example, if we have a dataset with events such as ‘radiofrequency ablation’ and ‘endoscopic mucosal resection’ or ‘nothing’ we can use the Sankey plot to determine the order of events over a large patient population. You choose the column in the dataframe that describes the Procedure type (“EMR”,“RFA”,“nothing” in this case)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">how&lt;-<span class="kw"><a href="../reference/SurveySankey.html">SurveySankey</a></span>(Myendo,<span class="st">"ProcPerformed"</span>)</code></pre></div>
<p><br></p>
<p><img src="img/EndoMineR_Sankey.svg" width="100%" style="display: block; margin: auto;"></p>
<p><br></p>
</div>
<div id="circos-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#circos-plots" class="anchor"></a>Circos plots</h4>
<p>We may need something even more aggregated. Perhaps we want to see the overall number of patients that go from one event to another regardless of which timepoint it is at. To do this we can use a circos plot, which makes use of the circlize library, as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flow&lt;-<span class="kw"><a href="../reference/PatientFlow_CircosPlots.html">PatientFlow_CircosPlots</a></span>(v,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>,<span class="st">"ProcedurePerformed"</span>)</code></pre></div>
<p><br></p>
<p><img src="img/EndoMineR_Circos.svg" width="60%" style="display: block; margin: auto;"></p>
<p><br></p>
</div>
</div>
<div id="assessment-of-quality-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#assessment-of-quality-functions" class="anchor"></a>Assessment of quality functions</h3>
<p>Quality is measured in a variety of different ways. For endoscopy it is measured according to the adherence to a) standards for endoscopic documentation as well as b) detection of certain pathological conditions such as dysplasia (best summarised as lesion recognition)</p>
<div id="documentation-quality" class="section level4">
<h4 class="hasAnchor">
<a href="#documentation-quality" class="anchor"></a>Documentation Quality</h4>
<p>As regards adherence to documentation for example, a generic function is provided that will look up the presence of words presented in a list in a target column. It will then output the proportion of reports that have these words, as well as a barchart to show what proportion of the endoscopies showed these words. The list can be comprised on terms that should be mentioned in a report.</p>
<p><strong><em>Input</em></strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pander</span>(<span class="kw">head</span>(<span class="kw">data.frame</span>(Myendo[<span class="dv">2</span>:<span class="dv">3</span>],Myendo[<span class="dv">13</span>])))</code></pre></div>
<table class="table">
<colgroup>
<col width="23%">
<col width="31%">
<col width="44%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">PatientName</th>
<th align="center">Findings</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Jargon, Victoria</td>
<td align="center">No evidence of Barrett’s oesophagus, short 2 cn hiatus hernia ,Oesophageal biopsies taken from three levels as requested ,OGD today to assess for ulceration/ongoing bleeding ,Diaphragmatic pinch:40cm ,She has a small hiatus hernia ,We will re-book for 2 weeks, rebanding ,Tiny erosions at the antrum ,Biopsies taken from top of stricture-metal marking clips in situ ,The varices flattened well with air insufflation ,He is on Barrett’s Screeling List in October 2017 at St Thomas’ HALO 90 done with good effect</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Powell, Destiny</td>
<td align="center">Duodenum: Duodenitis with a small erosion ,STOMACH: diffuse gastritis with angiodysplasia and punctate bleeding site on greater curve mid body - no obvious ulcer- antrum scar ?,No immediate complications ,Z-line at: 38cm - Bravo placed at 32cm- good positionat check endoscopy</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">Martinez-Santos, Ana</td>
<td align="center">Stomach- Body Polyp- Pedunculated ,Several erosions/small ulcers in inflammed antrum ,Lax cardia with small hiatus hernia but no erosive oesophagitis ,DUODENUM: Normal to D3</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Lopez, Maria</td>
<td align="center">STOMACH: Small amount of bright red blood that seems to have refluxed back through the pylorus</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">al-Rahimi, Rif’a</td>
<td align="center">Coffee ground vomit ,OESOPHAGUS: the previous subepithelial lesion measuring 1 TTS HALO to area</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">Forrest, Dazheea</td>
<td align="center">Stomach- Pylorus ,No cervical inlet patch</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>In this example we are looking for the words Barrett’s and coeliac as perhaps we have chosen the macroscopic recognition of these features to denote what an endoscopist should always describe in the endoscope report</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myNotableWords &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"arrett"</span>, <span class="st">"oeliac"</span>)
tt&lt;-<span class="kw"><a href="../reference/ListLookup.html">ListLookup</a></span>(Myendo,<span class="st">'Findings'</span>,myNotableWords)
<span class="kw">pander</span>(<span class="kw">head</span>(tt))</code></pre></div>
<table style="width:25%;" class="table">
<colgroup>
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">X2</th>
<th align="center">Prop</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">arrett</td>
<td align="center">18.45</td>
</tr>
<tr class="even">
<td align="center">oeliac</td>
<td align="center">6.2</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>So we can see that the terms are present in the minority of reports across endoscopists, so perhaps we can look into this further..</p>
<p><br></p>
</div>
<div id="endoscopic-quality" class="section level4">
<h4 class="hasAnchor">
<a href="#endoscopic-quality" class="anchor"></a>Endoscopic Quality</h4>
<div id="sedation-usage" class="section level5">
<h5 class="hasAnchor">
<a href="#sedation-usage" class="anchor"></a>Sedation Usage</h5>
<p>Another measure of quality is the assessment of those factors that are recorded at endoscopy such as degree of sedation used etc. Rather than provide a function for each metric, again a generic function is provided that uses any quantifiable metric and plots it against the endoscopist. This function returns a list with two elements- the plot and the table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Myendo&lt;-<span class="kw"><a href="../reference/EndoscMeds.html">EndoscMeds</a></span>(Myendo,<span class="st">'Medications'</span>)
<span class="kw">pander</span>(<span class="kw">head</span>(<span class="kw">data.frame</span>(Myendo$HospitalNumber,Myendo$Fent,Myendo$Midaz),<span class="dv">10</span>))</code></pre></div>
<table style="width:72%;" class="table">
<colgroup>
<col width="33%">
<col width="19%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">Myendo.HospitalNumber</th>
<th align="center">Myendo.Fent</th>
<th align="center">Myendo.Midaz</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">NA</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">125</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">125</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">NA</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">75</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">150</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">W2120051</td>
<td align="center">125</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">O7163832</td>
<td align="center">75</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">P6620949</td>
<td align="center">25</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">L4378217</td>
<td align="center">150</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MetricByEndoscopist.html">MetricByEndoscopist</a></span>(Myendo,<span class="st">'Endoscopist'</span>,<span class="st">'Fent'</span>)</code></pre></div>
<p><img src="Analysis_files/figure-html/exampleEndoscChopperMeds-1.png" width="672"></p>
<p><br></p>
<p><br></p>
</div>
</div>
<div id="pathology-detection-quality" class="section level4">
<h4 class="hasAnchor">
<a href="#pathology-detection-quality" class="anchor"></a>Pathology Detection Quality</h4>
<div id="polyp-and-sample-location" class="section level5">
<h5 class="hasAnchor">
<a href="#polyp-and-sample-location" class="anchor"></a>Polyp and sample location</h5>
<p><br></p>
<p>Although not strictly a measure of endoscopic quality, the location of polyps (as well as any sample location) can also be determined. This is particularly for lower GI endoscopy and can help determine whether, for example, the number of right sided polyps is lower than it should be for certain endoscopists.</p>
<p>To do this firstly the free text needs to be standardised. This is provided through the function TermStandardLocation which provides a standard correction for a number of typos and alternative spellings in histology. This also attempts to extract the sample location into a separate column</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f&lt;-<span class="kw"><a href="../reference/TermStandardLocation.html">TermStandardLocation</a></span>(Mypath,<span class="st">'Histology'</span>)
fgg&lt;-<span class="kw">data.frame</span>(f[(<span class="kw">ncol</span>(f)-<span class="dv">1</span>)],f[(<span class="kw">ncol</span>(f))])
<span class="kw">pander</span>(<span class="kw">head</span>(fgg,<span class="dv">10</span>))</code></pre></div>
<table style="width:92%;" class="table">
<colgroup>
<col width="45%">
<col width="45%">
</colgroup>
<thead><tr class="header">
<th align="center">SampleLocation</th>
<th align="center">AllSampleLocator</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">two biopsies consist of small bowel mucosa and are within normal histological limits</td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">modified giemsa stain ,these are biopsies of Stomach mucosa ,there is no evidence of coeliac disease ,the nuclei are hyperchromatic, ,there is no granulomatous inflammation ,the appearances are in keeping with a reactive/chemical gastritis,features including basal layer hyperplasia and reactive nucelar changes with underlying ,these are two biopsies of squamous epithelium within normal limits,fibromuscularisation of the lamina propria and mild chronic inflammation ,these biopsies of columnar mucosa show focal acute inflammation, moderate chronic inflammation</td>
<td align="center">Stomach</td>
</tr>
<tr class="odd">
<td align="center">the Sigmoid polyp is a tubular adenoma with moderate dysplasia ,inflammation, Stomach metaplasia, dysplasia or neoplasia is seen,patchy fibrosis and myxoid areas and contains numerous eosinophils, as well as scattered ,these biopsies of non-specialised Stomach-type mucosa showed minimal chronic, focally active ,lymphovascular invasion not identified ,into submucosa for less than mm</td>
<td align="center">Sigmoid, Stomach</td>
</tr>
<tr class="even">
<td align="center">there is mild chronic inflammation ,no intestinal metaplasia, dysplasia or malignancy is seen</td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="center">no helicobacter-like organisms are seen,no columnar mucosa is included,the biopsies of Oesophagus squamous mucosa show mild chronic inflammation with basal ,nature of specimen as stated on request form = ‘Ascending colon, Descending’,nogiardia organisms or granulomas are ,of moderately differentiated adenocarcinoma,raised intra-epithelial lymphocytes up to per enterocytes</td>
<td align="center">Oesophagus, Ascending, Descending</td>
</tr>
<tr class="even">
<td align="center">for pt tumours ,two pieces of tissue, the larger measuring mm and the smaller, ,there is a mild increase in intra-epithelial lymphocytes, upto ,the sections show a single biopsy of Oesophagus type squamous epithelium with a ,the biopsies of non-specialised and specialised Stomach mucosa show mild chronic inflammation</td>
<td align="center">Oesophagus, Stomach</td>
</tr>
<tr class="odd">
<td align="center">hyalinised thick collagen bundles with few interspersed spindle cells,clearly seen there appears to be subtotal villous atrophy,within these limitations, the d biopsies show patchy mild ,these biopsies of non-specialised Stomach-type mucosa show a mild chronic, inactivegastritis</td>
<td align="center">Stomach</td>
</tr>
<tr class="even">
<td align="center">the biopsies from the gastro-Oesophagus junction show squamo-columnar mucosa, some of ,there is no evidence of ,shows elongation of crypts, oedema, mildchronic inflammation and congestion,these biopsies of non-specialised Stomach mucosa show mild chronic inflammation ,submucosa is not included,are no features of eosinophilic oesophagitis ,no acute inflammation is seen ,there are occasional neutrophils ,the appearances are those of Duodenum ulcer</td>
<td align="center">Oesophagus, Stomach, Duodenum</td>
</tr>
<tr class="odd">
<td align="center">contains a moderate neutrophil infiltrate and there are foci of cryptitis,moderate acute and chronic inflammation ,there is no intestinal metaplasia or glandular ,the two biopsies on the strip show squamous epithelium with a dense neutrophil ,two pieces of tissue, the larger measuring mm and the smaller, ,the biopsies of Oesophagus squamous mucosa show minimal chronic inflammation with mild ,unequivocal intramucosal adenocarcinoma and no deeper invasion is seen</td>
<td align="center">Oesophagus</td>
</tr>
<tr class="even">
<td align="center">the sections show small bowel mucosa with a normal crypt to villous ratio and no increase in ,no parasites are seen,in the Transverse Colon sub-mucosa there ,cell hyperplasia</td>
<td align="center">Transverse, Colon</td>
</tr>
</tbody>
</table>
<p>Once this is done, a column called SampleLocation is appended to the existing dataset. This will attempt to state the location of all samples whether they are resections/ biopsies or polyps. If polyps specifically need to be located then the PolypLocator function can be used (after the TermStandardLocation function).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fgg&lt;-<span class="kw"><a href="../reference/PolypLocator.html">PolypLocator</a></span>(fgg,<span class="st">'SampleLocation'</span>) 
fg&lt;-<span class="kw">data.frame</span>(fgg[(<span class="kw">ncol</span>(fgg)-<span class="dv">2</span>)],fgg[(<span class="kw">ncol</span>(fgg)-<span class="dv">1</span>)],fgg[(<span class="kw">ncol</span>(fgg))])
<span class="kw">pander</span>(<span class="kw">head</span>(fg,<span class="dv">3</span>))</code></pre></div>
<table style="width:92%;" class="table">
<colgroup>
<col width="45%">
<col width="26%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">SampleLocation</th>
<th align="center">AllSampleLocator</th>
<th align="center">PolypLocator</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">two biopsies consist of small bowel mucosa and are within normal histological limits</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">modified giemsa stain ,these are biopsies of Stomach mucosa ,there is no evidence of coeliac disease ,the nuclei are hyperchromatic, ,there is no granulomatous inflammation ,the appearances are in keeping with a reactive/chemical gastritis,features including basal layer hyperplasia and reactive nucelar changes with underlying ,these are two biopsies of squamous epithelium within normal limits,fibromuscularisation of the lamina propria and mild chronic inflammation ,these biopsies of columnar mucosa show focal acute inflammation, moderate chronic inflammation</td>
<td align="center">Stomach</td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="center">the Sigmoid polyp is a tubular adenoma with moderate dysplasia ,inflammation, Stomach metaplasia, dysplasia or neoplasia is seen,patchy fibrosis and myxoid areas and contains numerous eosinophils, as well as scattered ,these biopsies of non-specialised Stomach-type mucosa showed minimal chronic, focally active ,lymphovascular invasion not identified ,into submucosa for less than mm</td>
<td align="center">Sigmoid, Stomach</td>
<td align="center">Sigmoid</td>
</tr>
</tbody>
</table>
<p>A further difficult area is the assessment of endoscopic quality by looking at the pathology processed from an endoscopy. This package is excellent at dealing with this kind of question because of its ability to merge the datasets together:</p>
<p>A particularly well developed area to look at is that of the Global Rating Scale for assessing the quality of colonoscopy. One of the metrics- the adenoma detection rate assesses the number of colonoscopies where at least one adenoma was detected.</p>
<p>One function is provided to produce a table that gives the number of adenomas, adenocarcinomas and hyperplastic polyps (also as a ration to adenomas) by endoscopist therefore immediately fulfilling the GRS requirement for the ADR as well as providing further metrics alongside</p>
</div>
<div id="adenoma-detection-rates" class="section level5">
<h5 class="hasAnchor">
<a href="#adenoma-detection-rates" class="anchor"></a>Adenoma Detection Rates</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Import the endoscopy and pathology datasets for colonoscopy</span>
 MypathColon&lt;-PathDataFrameFinalColon
 MyendoColon &lt;-<span class="st"> </span>ColonFinal
 <span class="co">#Rename the columns so that numbers do not lead the column titles</span>
 MyendoColon$OGDReportWhole &lt;-<span class="kw">gsub</span>(<span class="st">"2nd Endoscopist:"</span>,<span class="st">"Second endoscopist:"</span>,
 MyendoColon$OGDReportWhole)
 <span class="co">#Extract the columns needed from endoscopy</span>
 EndoscTree &lt;-<span class="kw">c</span>(<span class="st">"Hospital Number:"</span>,<span class="st">"Patient Name:"</span>,<span class="st">"General Practitioner:"</span>,
        <span class="st">"Date of procedure:"</span>,<span class="st">"Endoscopist:"</span>,<span class="st">"Second endoscopist:"</span>,<span class="st">"Medications"</span>,
        <span class="st">"Instrument"</span>,<span class="st">"Extent of Exam:"</span>,<span class="st">"Indications:"</span>,<span class="st">"Procedure Performed:"</span>,
        <span class="st">"Findings:"</span>,<span class="st">"Endoscopic Diagnosis:"</span>)
 MyendoColon&lt;-<span class="kw"><a href="../reference/Extractor.html">Extractor</a></span>(MyendoColon,<span class="st">"OGDReportWhole"</span>,EndoscTree)
 <span class="co">#Extract the columns needed from Histology</span>
 Histoltree &lt;-<span class="kw">c</span>(
     <span class="st">"Hospital Number:"</span>,<span class="st">"Patient Name:"</span>,<span class="st">"DOB:"</span>,<span class="st">"General Practitioner:"</span>,
     <span class="st">"Date received:"</span>,<span class="st">"Clinical Details"</span>,<span class="st">"Nature of specimen"</span>,<span class="st">"Macroscopic description:"</span>,<span class="st">"Histology"</span>,
     <span class="st">"Diagnosis"</span>)
<span class="co">#Tidy up to allow merge</span>
 MypathColon &lt;-<span class="kw"><a href="../reference/Extractor.html">Extractor</a></span>(MypathColon,<span class="st">"PathReportWhole"</span>,Histoltree)
 <span class="kw">names</span>(MypathColon)[<span class="kw">names</span>(MypathColon) ==<span class="st"> 'Datereceived'</span>] &lt;-<span class="st"> 'Dateofprocedure'</span>
 MypathColon$Dateofprocedure &lt;-<span class="st"> </span><span class="kw">as.Date</span>(MypathColon$Dateofprocedure)
 <span class="co">#Do the merge</span>
 vColon &lt;-<span class="kw"><a href="../reference/Endomerge2.html">Endomerge2</a></span>(MypathColon, <span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>,
                     MyendoColon, <span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>)

 
 <span class="co">#Use the function</span>
GRSTable&lt;-<span class="kw"><a href="../reference/GRS_Type_Assess_By_Unit.html">GRS_Type_Assess_By_Unit</a></span>(vColon,<span class="st">'ProcedurePerformed'</span>,<span class="st">'Endoscopist'</span>,<span class="st">'Diagnosis'</span>,<span class="st">'Histology'</span>)
<span class="kw">pander</span>(GRSTable)</code></pre></div>
<table style="width:97%;" class="table">
<caption>Table continues below</caption>
<colgroup>
<col width="38%">
<col width="19%">
<col width="19%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">Endoscopist</th>
<th align="center">NumAdenomas</th>
<th align="center">NumColons.x</th>
<th align="center">PropAdenomas</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Dr al-Huda, Ummu Kulthoom</td>
<td align="center">3</td>
<td align="center">204</td>
<td align="center">1.471</td>
</tr>
<tr class="even">
<td align="center">Dr al-Saade, Waajida</td>
<td align="center">2</td>
<td align="center">215</td>
<td align="center">0.9302</td>
</tr>
<tr class="odd">
<td align="center">Dr Confer, Mouneek</td>
<td align="center">6</td>
<td align="center">216</td>
<td align="center">2.778</td>
</tr>
<tr class="even">
<td align="center">Dr Gebregzabheir, Kiara</td>
<td align="center">4</td>
<td align="center">190</td>
<td align="center">2.105</td>
</tr>
<tr class="odd">
<td align="center">Dr Hasling, Emily</td>
<td align="center">6</td>
<td align="center">218</td>
<td align="center">2.752</td>
</tr>
<tr class="even">
<td align="center">Dr Monroe, Danjai</td>
<td align="center">7</td>
<td align="center">230</td>
<td align="center">3.043</td>
</tr>
<tr class="odd">
<td align="center">Dr Phillips, Harlie</td>
<td align="center">6</td>
<td align="center">233</td>
<td align="center">2.575</td>
</tr>
<tr class="even">
<td align="center">Dr Rahat, Janisa</td>
<td align="center">1</td>
<td align="center">217</td>
<td align="center">0.4608</td>
</tr>
<tr class="odd">
<td align="center">Dr Rubio, Jessica</td>
<td align="center">2</td>
<td align="center">180</td>
<td align="center">1.111</td>
</tr>
<tr class="even">
<td align="center">Dr Steinbach, Lindsey</td>
<td align="center">6</td>
<td align="center">191</td>
<td align="center">3.141</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col width="25%">
<col width="21%">
<col width="25%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="center">NumHyperplastics</th>
<th align="center">Colons(Count)</th>
<th align="center">PropHyperplastic</th>
<th align="center">NumAdenocarcinomas</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2</td>
<td align="center">204</td>
<td align="center">0.9804</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">NA</td>
<td align="center">215</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">216</td>
<td align="center">1.389</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">190</td>
<td align="center">1.579</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">218</td>
<td align="center">2.294</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">230</td>
<td align="center">0.8696</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">233</td>
<td align="center">1.288</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">217</td>
<td align="center">0.9217</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">180</td>
<td align="center">1.111</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">191</td>
<td align="center">1.571</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
<table style="width:86%;" class="table">
<colgroup>
<col width="16%">
<col width="30%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th align="center">NumColons</th>
<th align="center">PropAdenocarcinomas</th>
<th align="center">HyperplasticToAdenomaRatio</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">204</td>
<td align="center">NA</td>
<td align="center">1.5</td>
</tr>
<tr class="even">
<td align="center">215</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">216</td>
<td align="center">NA</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">190</td>
<td align="center">NA</td>
<td align="center">1.333</td>
</tr>
<tr class="odd">
<td align="center">218</td>
<td align="center">NA</td>
<td align="center">1.2</td>
</tr>
<tr class="even">
<td align="center">230</td>
<td align="center">NA</td>
<td align="center">3.5</td>
</tr>
<tr class="odd">
<td align="center">233</td>
<td align="center">NA</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">217</td>
<td align="center">NA</td>
<td align="center">0.5</td>
</tr>
<tr class="odd">
<td align="center">180</td>
<td align="center">NA</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">191</td>
<td align="center">NA</td>
<td align="center">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-analysis-functions">The Analysis Functions</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sebastian Zeki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
