<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EndoMineR • EndoMineR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">EndoMineR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/EndoMineRPrinciples.html">EndoMineR Principles</a>
    </li>
    <li>
      <a href="../articles/EndoMineR.html">Package overview</a>
    </li>
    <li>
      <a href="../articles/Analysis.html">Analysis</a>
    </li>
    <li>
      <a href="../articles/Barretts.html">Barrett's</a>
    </li>
    <li>
      <a href="../articles/Data.html">Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://gastrodatascience.com">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/GastroDS">
    <span class="fa fa-twitter-square"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/sebastiz/EndoMineR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>EndoMineR</h1>
                        <h4 class="author">Sebastian Zeki 2018-03-02</h4>
            
          </div>

    
    
<div class="contents">
<div id="aims-of-endominer" class="section level2">
<h2 class="hasAnchor">
<a href="#aims-of-endominer" class="anchor"></a>Aims of EndoMineR</h2>
<p>The goal of EndoMineR is to extract as much information as possible from free or semi-structured endoscopy reports and their associated pathology specimens.</p>
<p>Gastroenterology now has many standards against which practice is measured although many reporting systems do not include the reporting capability to give anything more than basic analysis. Much of the data is locked in semi-structured text. However the nature of semi-structured text means that data can be extracted in a standardised way- it just requires more manipulation. This package provides that manipulation so that complex endoscopic-pathological analyses, in line with recognised standards for these analyses, can be done.</p>
</div>
<div id="how-is-the-package-divided" class="section level2">
<h2 class="hasAnchor">
<a href="#how-is-the-package-divided" class="anchor"></a>How is the package divided?</h2>
<p><br></p>
<p><img src="img/EndoMineROverView.png" width="50%" style="display: block; margin: auto;"></p>
<p>The package is basically divied into three parts. How all the functions are connected in shown in the adjoining figure. The import of the raw data is left up to the user with the overall aim being that all the data is present in one dataframe. The user can either load data so that each row of the data is an endoscopic episode (or a pathology report) in its raw form and then allow the package to extract the relevant parts of the data, or the data can be pre-extracted (ie separate columns for the Endoscopist, medication given etc.) so that the Extraction step is skipped. The package can take either but the importing is left to the user.</p>
<ol style="list-style-type: decimal">
<li><p><strong>The extraction</strong>- This is really when the data is provided as full text reports. You may already have the data in a spreadsheet in which case this part isn’t necessary. The extraction is provided as one function Extractor, explained below.</p></li>
<li><p><strong>Cleaning</strong>- These are a group of functions that allow the user to extract and clean data commonly found in endoscopic and pathology reports. The cleaning functions usually remove common typos or extraneous information and do some reformatting. Some of the functions will also extract derived data into separate columns. The cleaning functions are provided on a per column basis (so if you have a column containing the endoscopist name, for example ,then EndoEndoscopist will clean this. However convenience functions are also provided to run the cleaning functions on several columns where present. EndoscAll for example will run several of the cleaning functions as long as the columns are properly named so that the subfunctions are run on the correct columns.</p></li>
<li><p><strong>Analyses</strong>- The analyses provide graphing function as well as analyses according to the cornerstone questions in gastroenterology- namely surveillance, patient tracking, quality of endoscopy and pathology reporting and diagnostic yield questions as explained in the EndoMineR principles pages. The analyses are separated into generic analyses that are relevant to any endo-pathological dataset, as well as specific analyses for adenoma detection rates and Barrett’s surveillance and therapy. Further disease specific datasets will be included in future iterations.</p></li>
</ol>
</div>
<div id="the-extractor-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-extractor-function" class="anchor"></a>The extractor function</h2>
<p>Endoscopic and pathological data will come in one of two forms- either as a collection of the whole text report or as spreadsheets with some degree of separation into different columns of the various aspects of that report eg who the Endoscopist was, the patient’s unique identifier etc. For the latter, the package user will not need to Extract information as it is already extracted and so can go straight to cleaning the data. For the former the Extractor function has been provided:</p>
<p><br><img src="img/EndoMineR_Extractor.svg" style="display: block; margin: auto;"></p>
<p><br></p>
<p>The Extractor is a very useful function. Different hospitals will use different software with different headings for endoscopic reports. The extractor allows the user to define the separations in a report so that all reports can be automatically placed into a meaningful dataframe for further cleaning. Here we use the in-built datasets as part of the package. Prior to using the function it is recommended to use the NewLine function to divide the free text up by sentence (this can be useful if not using multiline regex or you have another way of splitting the text rather than using the Extractor). However this is not absolutely necessary.</p>
<p><br></p>
<p>A list of keywords is then constructed. This list is made up of the words that will be used to split the document. It is very common for individual departments in both gastroenterology and pathology to use semi-structured reporting so that the same headers are used between patient reports. The list is therefore populated with these headers as defined by the user. The Extractor then does the splitting for each pair of words, dumps the text between the delimiter in a new column and names that column with the first keyword in the pair with some cleaning up and then returns the new dataframe. Here we use an example dataset:</p>
<table style="width:44%;" class="table">
<colgroup><col width="44%"></colgroup>
<thead><tr class="header">
<th align="center">PathReportWhole</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Hospital: Random NHS Foundation Trust Hospital Number: H2890235 Patient Name: al-Bilal, Widdad DOB: 1922-05-04 General Practitioner: Dr. Mondragon, Amber Date received: 2002-11-10 Clinical Details: Previous had serrated lesions ?,If looks more like UC, please provide Nancy severity index 3 specimen. Nature of specimen: Nature of specimen as stated on pot = ‘Ascending colon x2’|,Nature of specimen as stated on request form = ‘rectum’|,Nature of specimen as stated on pot = ‘4X LOWER, 4X UPPER OESOPHAGUS’|,Nature of specimen as stated on pot = ‘rectal polyp’| Macroscopic description: 1 specimens collected the largest measuring 3 x 5 x 2 mm and the smallest 3 x 5 x 5 mm Histology: The appearances are of a hyperplastic polyp.,8 pieces of tissue, the largest measuring 4 x 36 x 2 mm and the smallest 3 x 3.,Completeness of excision is uncertain as the base is not clearly visualised.,There is no ulceration.,Kikuchi level: sm2. Diagnosis: Colon, biopsy - Normal.,- Focal granulomatous inflammation, non-necrotising.,Duodenum, biopsy - within normal histological limits.,Sigmoid colon, polypectomy: - Tubular adenoma with moderate dysplasia.,- Hyperplastic polyp .,Caecum polyp biopsies:- tubular adenoma, low grade dysplasia.,- Mild chronic inflammation within the oesophageal mucosa.,Sigmoid colon biopsies:- normal mucosa.,Sigmoid polyp excision:- tubular adenoma.</td>
</tr></tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mywords&lt;-<span class="kw">c</span>(<span class="st">"Hospital Number"</span>,<span class="st">"Patient Name:"</span>,<span class="st">"DOB:"</span>,<span class="st">"General Practitioner:"</span>,
<span class="st">"Date received:"</span>,<span class="st">"Clinical Details:"</span>,<span class="st">"Macroscopic description:"</span>,
<span class="st">"Histology:"</span>,<span class="st">"Diagnosis:"</span>)
PathDataFrameFinalColon2&lt;-<span class="kw"><a href="../reference/Extractor.html">Extractor</a></span>(PathDataFrameFinalColon2,<span class="st">"PathReportWhole"</span>,mywords)</code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="8%">
<col width="5%">
<col width="10%">
<col width="6%">
<col width="15%">
<col width="15%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">PatientName</th>
<th align="center">DOB</th>
<th align="center">GeneralPractitioner</th>
<th align="center">Datereceived</th>
<th align="center">ClinicalDetails</th>
<th align="center">Macroscopicdescription</th>
<th align="center">Histology</th>
<th align="center">Diagnosis</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">H2890235</td>
<td align="center">al-Bilal, Widdad</td>
<td align="center">1922-05-04</td>
<td align="center">Dr Mondragon, Amber</td>
<td align="center">2002-11-10</td>
<td align="center">Previous had serrated lesions ?,If looks more like UC, please provide Nancy severity index 3 specimen Nature of specimen: Nature of specimen as stated on pot = ‘Ascending colon x2’|,Nature of specimen as stated on request form = ‘rectum’|,Nature of specimen as stated on pot = ‘4X LOWER, 4X UPPER OESOPHAGUS’|,Nature of specimen as stated on pot = ‘rectal polyp’|</td>
<td align="center">1 specimens collected the largest measuring 3 x 5 x 2 mm and the smallest 3 x 5 x 5 mm</td>
<td align="center">The appearances are of a hyperplastic polyp ,8 pieces of tissue, the largest measuring 4 x 36 x 2 mm and the smallest 3 x 3 ,Completeness of excision is uncertain as the base is not clearly visualised ,There is no ulceration ,Kikuchi level: sm2</td>
<td align="center">Colon, biopsy - Normal ,- Focal granulomatous inflammation, non-necrotising ,Duodenum, biopsy - within normal histological limits ,Sigmoid colon, polypectomy: - Tubular adenoma with moderate dysplasia ,- Hyperplastic polyp ,Caecum polyp biopsies:- tubular adenoma, low grade dysplasia ,- Mild chronic inflammation within the oesophageal mucosa ,Sigmoid colon biopsies:- normal mucosa ,Sigmoid polyp excision:- tubular adenoma</td>
</tr></tbody>
</table>
</div>
<div id="endoscopic-cleaning" class="section level2">
<h2 class="hasAnchor">
<a href="#endoscopic-cleaning" class="anchor"></a>Endoscopic cleaning</h2>
<p>Once the extraction has been done there are various cleaning functions provided based around the extraction of likely columns.This is illustrated in the figure below:</p>
<p><br></p>
<p><img src="img/EndoMineR_EndoscopyClean.png" style="display: block; margin: auto;"></p>
<p><br></p>
<div id="endoscopist-cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#endoscopist-cleaning" class="anchor"></a>Endoscopist cleaning</h3>
<p>For example if the Endoscopist name has been pulled out, the EndoscEndoscopist function can be used which returns the submitted data frame with the Endoscopist column cleaned up.</p>
<p><br></p>
<p>The endoscopist column might initially look like this:</p>
<p><br></p>
<table class="table">
<colgroup>
<col width="15%">
<col width="20%">
<col width="21%">
<col width="16%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">PatientName</th>
<th align="center">GeneralPractitioner</th>
<th align="center">Dateofprocedure</th>
<th align="center">Endoscopist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Jargon, Victoria</td>
<td align="center">Dr Martin, Marche</td>
<td align="center">2009-11-11</td>
<td align="center">Dr Sullivan, Shelby</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Powell, Destiny</td>
<td align="center">Dr al-Safi, Lutfiyya</td>
<td align="center">2008-06-15</td>
<td align="center">Dr Kekich, Annabelle</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">Martinez-Santos, Ana</td>
<td align="center">Dr Rogers, Monica</td>
<td align="center">2007-10-27</td>
<td align="center">Dr Sullivan, Shelby</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Lopez, Maria</td>
<td align="center">Dr Heilman, Lisa</td>
<td align="center">2002-03-17</td>
<td align="center">Dr Avitia-Ramirez, Alondra</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">al-Rahimi, Rif’a</td>
<td align="center">Dr Krumland, Lisa</td>
<td align="center">2011-12-05</td>
<td align="center">Dr Greimann, Phoua</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">Forrest, Dazheea</td>
<td align="center">Dr Millman, Arianna</td>
<td align="center">2014-09-19</td>
<td align="center">Dr Avitia-Ramirez, Alondra</td>
</tr>
<tr class="odd">
<td align="center">W2120051</td>
<td align="center">Naperola, Breanna</td>
<td align="center">Dr Vigil, Lidia</td>
<td align="center">2002-05-28</td>
<td align="center">Dr Martinez, Maegen</td>
</tr>
<tr class="even">
<td align="center">O7163832</td>
<td align="center">Zuni, Shannon</td>
<td align="center">Dr Merced, Essence</td>
<td align="center">2009-09-19</td>
<td align="center">Dr Anderson, Alana</td>
</tr>
<tr class="odd">
<td align="center">P6620949</td>
<td align="center">Gomez Barron, Erin</td>
<td align="center">Dr Ursery, Dezire</td>
<td align="center">2003-10-02</td>
<td align="center">Dr Anderson, Alana</td>
</tr>
<tr class="even">
<td align="center">L4378217</td>
<td align="center">Hamm, Shebra</td>
<td align="center">Dr Bauman, Caitlin</td>
<td align="center">2016-11-22</td>
<td align="center">Dr Ives, Rashiah</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Myendo2&lt;-<span class="kw"><a href="../reference/EndoscEndoscopist.html">EndoscEndoscopist</a></span>(Myendo,<span class="st">'Endoscopist'</span>)</code></pre></div>
<p>This function performs the cleaning of common things found in the text that may cause confusion such as getting rid of the titles ahead of the Endoscopist’s name. The result is as follows:</p>
<p><br></p>
<table class="table">
<colgroup>
<col width="15%">
<col width="21%">
<col width="22%">
<col width="16%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">PatientName</th>
<th align="center">GeneralPractitioner</th>
<th align="center">Dateofprocedure</th>
<th align="center">Endoscopist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Jargon, Victoria</td>
<td align="center">Dr Martin, Marche</td>
<td align="center">2009-11-11</td>
<td align="center">Sullivan, Shelby</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Powell, Destiny</td>
<td align="center">Dr al-Safi, Lutfiyya</td>
<td align="center">2008-06-15</td>
<td align="center">Kekich, Annabelle</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">Martinez-Santos, Ana</td>
<td align="center">Dr Rogers, Monica</td>
<td align="center">2007-10-27</td>
<td align="center">Sullivan, Shelby</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Lopez, Maria</td>
<td align="center">Dr Heilman, Lisa</td>
<td align="center">2002-03-17</td>
<td align="center">Avitia-Ramirez, Alondra</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">al-Rahimi, Rif’a</td>
<td align="center">Dr Krumland, Lisa</td>
<td align="center">2011-12-05</td>
<td align="center">Greimann, Phoua</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">Forrest, Dazheea</td>
<td align="center">Dr Millman, Arianna</td>
<td align="center">2014-09-19</td>
<td align="center">Avitia-Ramirez, Alondra</td>
</tr>
<tr class="odd">
<td align="center">W2120051</td>
<td align="center">Naperola, Breanna</td>
<td align="center">Dr Vigil, Lidia</td>
<td align="center">2002-05-28</td>
<td align="center">Martinez, Maegen</td>
</tr>
<tr class="even">
<td align="center">O7163832</td>
<td align="center">Zuni, Shannon</td>
<td align="center">Dr Merced, Essence</td>
<td align="center">2009-09-19</td>
<td align="center">Anderson, Alana</td>
</tr>
<tr class="odd">
<td align="center">P6620949</td>
<td align="center">Gomez Barron, Erin</td>
<td align="center">Dr Ursery, Dezire</td>
<td align="center">2003-10-02</td>
<td align="center">Anderson, Alana</td>
</tr>
<tr class="even">
<td align="center">L4378217</td>
<td align="center">Hamm, Shebra</td>
<td align="center">Dr Bauman, Caitlin</td>
<td align="center">2016-11-22</td>
<td align="center">Ives, Rashiah</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="medication-cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#medication-cleaning" class="anchor"></a>Medication cleaning</h3>
<p>The EndoscMeds currently extracts Fentanyl and Midazolam doses into a separate column and reformats them as numeric columns so further calculations can be done. In future iterations pethidine, propofol and general anaesthetic will also be able to be extracted.</p>
<p>Several other similar clean up functions are available for Endoscopy as follows. We will extract from the Raw endoscopy data first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mywords&lt;-<span class="kw">c</span>(<span class="st">"Hospital:"</span>,<span class="st">"Hospital Number:"</span>,<span class="st">"Patient Name:"</span>,<span class="st">"General Practitioner:"</span>,<span class="st">"Date of procedure:"</span>,<span class="st">"Endoscopist:"</span>,<span class="st">"Second Endoscopist"</span>,
           <span class="st">"Medications:"</span>,<span class="st">"Instrument:"</span>,<span class="st">"Extent of Exam:"</span>,<span class="st">"Indications:"</span>,<span class="st">"Procedure Performed:"</span>,
<span class="st">"Findings:"</span>,<span class="st">"Diagnosis:"</span>)
TheOGDReportFinal2&lt;-<span class="kw"><a href="../reference/Extractor.html">Extractor</a></span>(TheOGDReportFinal,<span class="st">"OGDReportWhole"</span>,mywords)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TheOGDReportFinal2df&lt;-<span class="kw">data.frame</span>(TheOGDReportFinal2[<span class="st">"HospitalNumber"</span>],TheOGDReportFinal2[<span class="st">"Instrument"</span>],TheOGDReportFinal2[<span class="st">"Indications"</span>],TheOGDReportFinal2[<span class="st">"Medications"</span>],TheOGDReportFinal2[<span class="st">"ProcedurePerformed"</span>])
<span class="kw">pander</span>(<span class="kw">head</span>(TheOGDReportFinal2df,<span class="dv">10</span>))</code></pre></div>
<table class="table">
<colgroup>
<col width="15%">
<col width="11%">
<col width="27%">
<col width="27%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">Instrument</th>
<th align="center">Indications</th>
<th align="center">Medications</th>
<th align="center">ProcedurePerformed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">FG5</td>
<td align="center">Follow-up ULCER HEALING</td>
<td align="center">Fentanyl 12 5mcg Midazolam 6mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">FG6</td>
<td align="center">Weight Loss</td>
<td align="center">Fentanyl 125mcg Midazolam 7mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">FG2</td>
<td align="center">Follow-up ULCER HEALING</td>
<td align="center">Fentanyl 125mcg Midazolam 6mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">FG1</td>
<td align="center">Other-</td>
<td align="center">Fentanyl 12 5mcg Midazolam 2mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">FG2</td>
<td align="center">Previous OGD ? 8 months ago</td>
<td align="center">Fentanyl 75mcg Midazolam 6mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">FG6</td>
<td align="center">Surveillance-Barrett’s</td>
<td align="center">Fentanyl 150mcg Midazolam 3mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="odd">
<td align="center">W2120051</td>
<td align="center">FG5</td>
<td align="center">Dyspepsia</td>
<td align="center">Fentanyl 125mcg Midazolam 5mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="even">
<td align="center">O7163832</td>
<td align="center">FG2</td>
<td align="center">Oesophagus- Dysplasia</td>
<td align="center">Fentanyl 75mcg Midazolam 3mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="odd">
<td align="center">P6620949</td>
<td align="center">FG4</td>
<td align="center">Oesophagus- Dysplasia</td>
<td align="center">Fentanyl 25mcg Midazolam 1mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
<tr class="even">
<td align="center">L4378217</td>
<td align="center">FG7</td>
<td align="center">Therapeutic- Dilatation</td>
<td align="center">Fentanyl 150mcg Midazolam 1mg</td>
<td align="center">Gastroscopy (OGD)</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/EndoscMeds.html">EndoscMeds</a></span>(TheOGDReportFinal2df,<span class="st">'Medications'</span>)</code></pre></div>
<table class="table">
<colgroup>
<col width="13%">
<col width="10%">
<col width="23%">
<col width="24%">
<col width="16%">
<col width="5%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">Instrument</th>
<th align="center">Indications</th>
<th align="center">Medications</th>
<th align="center">ProcedurePerformed</th>
<th align="center">Fent</th>
<th align="center">Midaz</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">FG5</td>
<td align="center">Follow-up ULCER HEALING</td>
<td align="center">Fentanyl 12 5mcg Midazolam 6mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">NA</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">FG6</td>
<td align="center">Weight Loss</td>
<td align="center">Fentanyl 125mcg Midazolam 7mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">125</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">FG2</td>
<td align="center">Follow-up ULCER HEALING</td>
<td align="center">Fentanyl 125mcg Midazolam 6mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">125</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">FG1</td>
<td align="center">Other-</td>
<td align="center">Fentanyl 12 5mcg Midazolam 2mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">NA</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">FG2</td>
<td align="center">Previous OGD ? 8 months ago</td>
<td align="center">Fentanyl 75mcg Midazolam 6mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">75</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">FG6</td>
<td align="center">Surveillance-Barrett’s</td>
<td align="center">Fentanyl 150mcg Midazolam 3mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">150</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">W2120051</td>
<td align="center">FG5</td>
<td align="center">Dyspepsia</td>
<td align="center">Fentanyl 125mcg Midazolam 5mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">125</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">O7163832</td>
<td align="center">FG2</td>
<td align="center">Oesophagus- Dysplasia</td>
<td align="center">Fentanyl 75mcg Midazolam 3mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">75</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">P6620949</td>
<td align="center">FG4</td>
<td align="center">Oesophagus- Dysplasia</td>
<td align="center">Fentanyl 25mcg Midazolam 1mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">25</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">L4378217</td>
<td align="center">FG7</td>
<td align="center">Therapeutic- Dilatation</td>
<td align="center">Fentanyl 150mcg Midazolam 1mg</td>
<td align="center">Gastroscopy (OGD)</td>
<td align="center">150</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
</div>
<div id="instrumentindications-and-procedure-type-cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#instrumentindications-and-procedure-type-cleaning" class="anchor"></a>Instrument,Indications and Procedure type cleaning</h3>
<p>EndoscInstrument,EndoscIndications and EndoscProcPerformed all perform similar cleaning functions with the endoscope number, the indication for the investigation and the actual procedure performed respectively. Future iterations will try to make these cleaning functions more generic and applicable to a wider number of use cases.</p>
</div>
</div>
<div id="histological-cleaning" class="section level2">
<h2 class="hasAnchor">
<a href="#histological-cleaning" class="anchor"></a>Histological cleaning</h2>
<p>The cleaning functions for histology are a little more difficult as Histology reports often have a greater degree of free text reporting. In general, each histology report can be divided into the Macroscopic description of a specimen which itself is comprised of how many specimens there are for each sample sent (a sample can be a pot which includes several specimens) and how big each specimen is. The report will often give a detailed description of what is actually seen and then provide an overall diagnosis.</p>
<p><br></p>
<p><img src="img/EndoMineR_HistopExtrapol.png" style="display: block; margin: auto;"></p>
<p><br></p>
<div id="basic-histology-cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#basic-histology-cleaning" class="anchor"></a>Basic Histology Cleaning</h3>
<p>The histology cleaning functions are based around this. For example, the HistolHistol cleans the Histology text if present.</p>
<p><br> The original input example can be seen here:</p>
<pre><code>## [1] "  Two biopsies consist of small bowel mucosa and are within normal histological limits\n\n"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
## [2] "  modified giemsa stain\n,These are biopsies of gastric mucosa ,There is no evidence of coeliac disease\n,The nuclei are hyperchromatic,\n,There is no granulomatous inflammation\n,The appearances are in keeping with a reactive/chemical gastritis,features including basal layer hyperplasia and reactive nucelar changes with underlying\n,These are two biopsies of squamous epithelium within normal limits,fibromuscularisation of the lamina propria and mild chronic inflammation\n,These biopsies of columnar mucosa show focal acute inflammation, moderate chronic inflammation\n\n"</code></pre>
<p>And once the function is run the result is here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t&lt;-<span class="kw"><a href="../reference/HistolHistol.html">HistolHistol</a></span>(Mypath,<span class="st">'Histology'</span>)</code></pre></div>
<pre><code>## [1] "  Two biopsies consist of small bowel mucosa and are within normal histological limits \n"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
## [2] "  modified giemsa stain ,These are biopsies of gastric mucosa ,There is no evidence of coeliac disease\n,The nuclei are hyperchromatic,\n,There is no granulomatous inflammation\n,The appearances are in keeping with a reactive/chemical gastritis,features including basal layer hyperplasia and reactive nucelar changes with underlying\n,These are two biopsies of squamous epithelium within normal limits,fibromuscularisation of the lamina propria and mild chronic inflammation\n,These biopsies of columnar mucosa show focal acute inflammation, moderate chronic inflammation\n\n"</code></pre>
<p><br></p>
</div>
<div id="extraction-of-macroscopic-description" class="section level3">
<h3 class="hasAnchor">
<a href="#extraction-of-macroscopic-description" class="anchor"></a>Extraction of Macroscopic Description</h3>
<p>Because the information from the Macroscopic Description is based around numbers, a further function has been provided to extract numbers from the text. This function is usually only used as part of HistolNumOfBx which extracts the number of biopsies taken.</p>
<p>In order to extract the numbers, the limit of what has to be extracted has to be set as part of the regex so that the function takes whatever word limits the selection.It collects everything from the regex [0-9]{1,2}.{0,3} to whatever the string boundary is.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/HistolNumbOfBx.html">HistolNumbOfBx</a></span>(Mypath,<span class="st">'Macroscopicdescription'</span>,<span class="st">'specimen'</span>)</code></pre></div>
</div>
<div id="extraction-of-specific-disease-entities" class="section level3">
<h3 class="hasAnchor">
<a href="#extraction-of-specific-disease-entities" class="anchor"></a>Extraction of Specific Disease Entities</h3>
<p>The user may want to extract specific diseases from a histology dataset. This can be done using the function HistolExtrapolDx which simply takes the Diagnosis column and looks up the presence or absence of certain diseases. The function has been hard coded to look for dysplasia, cancer or GIST but may be user defined in future iterations</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Mypath3&lt;-<span class="kw">data.frame</span>(Mypath[<span class="st">"HospitalNumber"</span>],Mypath[<span class="st">"Diagnosis"</span>])</code></pre></div>
<table style="width:68%;" class="table">
<colgroup>
<col width="23%">
<col width="44%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">Diagnosis</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Distal transverse colon polyp excision:- tubular adenoma, low grade dysplasia ,Ileo-caecal valve, biopsies: ,Stomach antrum biopsies:- normal mucosa ,- Up to 34 eosinophils per high power field,Stomach, biopsy - Mild chronic inflammation</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Rectum, polyp biopsy: - Tubular adenoma with mild dysplasia,- Raised intra-epithelial lymphocytes ,Duodenum, biopsies - within normal histological limits ,B GI biopsy - DISTAL OESOPHAGUS X2, MID OESO X3, PROX OESO X2 ,Oesophagus, biopsies : - Minimal chronic inflammation,Sigmoid colon, polypectomy: - Tubular adenoma with moderate dysplasia,Oesophagus polyps biopsies:- 2 x papillomas ,Duodenum biopsies:- normal</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">- Background Barrett ‘s oesophagus,Sigmoid colon, biopsy - Adenocarcinoma ,- Gastric metaplasia,Oesophagus 36cm ’papilloma’ biopsy:- normal squamous mucosa ,- Chronic active inflammation,Oesophagus, biopsy - Barrett ’s oesophagus with moderate chronic inflammation ,- Minimal chronic inflammation</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Stomach, biopsy - Mild chronic inflammation and reactive changes ,- Normal,- note: biopsies put into the wrong pots ,Oesophagus, biopsy - Poorly differentiated tumour ,Rectum, polyp biopsy: - Tubular adenoma with mild dysplasia,- Mild chronic inflammation and oedema,-Inflammatory fibroid polyp,- within normal histological limits,- Negative for HLO</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">Nodule GOJ, biopsies:- acute and chronic inflammation with Helicobacter ,Stomach, biopsy -Mild acute and chronic inflammation ,Oesophagus polyps biopsies:- 2 x papillomas ,- &lt;1 mm from lateral margin,Duodenum biopsies:- patchy increase in IELs ,Duodenum, biopsy - Normal</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">Duodenum and stomach, polyp biopsies - Consistent with hamartomatous polyps ,Gastric oesophageal junction, biopsies : - Chronic inflammation,Stomach, biopsy - Mild chronic inflammation ,- Gastric HER2 negative,- Minimal chronic inflammation,Oesophagus, biopsy - Acute inflammation in presumed proximal biopsies only ,Gastro-osophageal junction, biopsy - Squamocolumnar mucosa ,Descending colon biopsies:- normal mucosa ,- Within normalhistological limits,The biopsies of gastric oesophageal junction type squamo-columnar mucosa show mild chronic</td>
</tr>
<tr class="odd">
<td align="center">W2120051</td>
<td align="center">- Negative for helicobacter,- Intestinal metaplasia ,Oesophagus biopsies:- normal ,Ileum and colon biopsies:- normal mucosa ,Oesophagus, EMR 43P - Barrett ’s oesophagus without intestinal metaplasia ,Sigmoid colon, biopsy - Adenocarcinoma ,- Chronic active inflammation,Duodenum biopsies:- normal mucosa ,- Low grade dysplasia</td>
</tr>
<tr class="even">
<td align="center">O7163832</td>
<td align="center">- possible eosinophilic oesophagitis,- Mild chronic gastritis,A -E) Stomach, polyps, biopsies: ,- Mild chronic inflammation and oedema,- Focal mild chronic inflammation,- Gastric HER2 negative,Ileum and colon biopsies:- normal mucosa ,Adjacent mucosa, biopsy - Normal small bowel mucosa</td>
</tr>
<tr class="odd">
<td align="center">P6620949</td>
<td align="center">- Chronic active gastritis,Stomach, biopsy - Chronic, moderately active Helicobacter associated gastritis ,Oesophaguas biopsies:- normal mucosa ,- Acute inflammatory exudate,Right and left colon, biopsies: - Within normal histological limits</td>
</tr>
<tr class="even">
<td align="center">L4378217</td>
<td align="center">Stomach, biopsy - Chronic, moderately active Helicobacter associated gastritis ,- tubular adenoma, low grade dysplasia x 1 ,- Tubular adenoma,- Tubular adenoma,Sigmoid colon, polyp biopsy - Hyperplastic polyp ,Stomach, biopsy - Reactive gastritis and intestinal metaplasia ,- Chronic inflammation,- Mild chronic inflammation</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Mypath3&lt;-<span class="kw"><a href="../reference/HistolExtrapolDx.html">HistolExtrapolDx</a></span>(Mypath3,<span class="st">"Diagnosis"</span>)</code></pre></div>
<table class="table">
<colgroup>
<col width="22%">
<col width="42%">
<col width="11%">
<col width="15%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="center">HospitalNumber</th>
<th align="center">Diagnosis</th>
<th align="center">Cancer</th>
<th align="center">Dysplasia</th>
<th align="center">GIST</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Distal transverse colon polyp excision:- tubular adenoma, low grade dysplasia ,Ileo-caecal valve, biopsies: ,Stomach antrum biopsies:- normal mucosa ,- Up to 34 eosinophils per high power field,Stomach, biopsy - Mild chronic inflammation</td>
<td align="center">NA</td>
<td align="center">dyspla</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Rectum, polyp biopsy: - Tubular adenoma with mild dysplasia,- Raised intra-epithelial lymphocytes ,Duodenum, biopsies - within normal histological limits ,B GI biopsy - DISTAL OESOPHAGUS X2, MID OESO X3, PROX OESO X2 ,Oesophagus, biopsies : - Minimal chronic inflammation,Sigmoid colon, polypectomy: - Tubular adenoma with moderate dysplasia,Oesophagus polyps biopsies:- 2 x papillomas ,Duodenum biopsies:- normal</td>
<td align="center">NA</td>
<td align="center">dyspla</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">- Background Barrett ‘s oesophagus,Sigmoid colon, biopsy - Adenocarcinoma ,- Gastric metaplasia,Oesophagus 36cm ’papilloma’ biopsy:- normal squamous mucosa ,- Chronic active inflammation,Oesophagus, biopsy - Barrett ’s oesophagus with moderate chronic inflammation ,- Minimal chronic inflammation</td>
<td align="center">carcin</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Stomach, biopsy - Mild chronic inflammation and reactive changes ,- Normal,- note: biopsies put into the wrong pots ,Oesophagus, biopsy - Poorly differentiated tumour ,Rectum, polyp biopsy: - Tubular adenoma with mild dysplasia,- Mild chronic inflammation and oedema,-Inflammatory fibroid polyp,- within normal histological limits,- Negative for HLO</td>
<td align="center">NA</td>
<td align="center">dyspla</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">Nodule GOJ, biopsies:- acute and chronic inflammation with Helicobacter ,Stomach, biopsy -Mild acute and chronic inflammation ,Oesophagus polyps biopsies:- 2 x papillomas ,- &lt;1 mm from lateral margin,Duodenum biopsies:- patchy increase in IELs ,Duodenum, biopsy - Normal</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">I8031481</td>
<td align="center">Duodenum and stomach, polyp biopsies - Consistent with hamartomatous polyps ,Gastric oesophageal junction, biopsies : - Chronic inflammation,Stomach, biopsy - Mild chronic inflammation ,- Gastric HER2 negative,- Minimal chronic inflammation,Oesophagus, biopsy - Acute inflammation in presumed proximal biopsies only ,Gastro-osophageal junction, biopsy - Squamocolumnar mucosa ,Descending colon biopsies:- normal mucosa ,- Within normalhistological limits,The biopsies of gastric oesophageal junction type squamo-columnar mucosa show mild chronic</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">W2120051</td>
<td align="center">- Negative for helicobacter,- Intestinal metaplasia ,Oesophagus biopsies:- normal ,Ileum and colon biopsies:- normal mucosa ,Oesophagus, EMR 43P - Barrett ’s oesophagus without intestinal metaplasia ,Sigmoid colon, biopsy - Adenocarcinoma ,- Chronic active inflammation,Duodenum biopsies:- normal mucosa ,- Low grade dysplasia</td>
<td align="center">carcin</td>
<td align="center">dyspla</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">O7163832</td>
<td align="center">- possible eosinophilic oesophagitis,- Mild chronic gastritis,A -E) Stomach, polyps, biopsies: ,- Mild chronic inflammation and oedema,- Focal mild chronic inflammation,- Gastric HER2 negative,Ileum and colon biopsies:- normal mucosa ,Adjacent mucosa, biopsy - Normal small bowel mucosa</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">P6620949</td>
<td align="center">- Chronic active gastritis,Stomach, biopsy - Chronic, moderately active Helicobacter associated gastritis ,Oesophaguas biopsies:- normal mucosa ,- Acute inflammatory exudate,Right and left colon, biopsies: - Within normal histological limits</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">L4378217</td>
<td align="center">Stomach, biopsy - Chronic, moderately active Helicobacter associated gastritis ,- tubular adenoma, low grade dysplasia x 1 ,- Tubular adenoma,- Tubular adenoma,Sigmoid colon, polyp biopsy - Hyperplastic polyp ,Stomach, biopsy - Reactive gastritis and intestinal metaplasia ,- Chronic inflammation,- Mild chronic inflammation</td>
<td align="center">NA</td>
<td align="center">dyspla</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
<p>Other less useful functions include but which may be useful in certain hospitals and certain situations in</p>
<ol style="list-style-type: decimal">
<li>HistolAccessionNumber which extracts Accession Number data from the report where one is present.The Accession number relates to the actual specimen number as ascribed by the pathology service.</li>
</ol>
<p><br><br></p>
</div>
</div>
<div id="removal-of-negatives" class="section level2">
<h2 class="hasAnchor">
<a href="#removal-of-negatives" class="anchor"></a>Removal of negatives</h2>
<p>In addition, if there is a need to remove all sentences that give negative diagnoses (eg “There is no evidence of…”) so that false positive diagnoses are not made during the analysis stage, a further function can be applied called NegativeRemove. It can be applied as a stand alone function but is also implemented within the HistolDx function which extracts and cleans the diagnosis from the Histology text.</p>
<p><br> The original input example can be seen here</p>
<pre><code>## [1] "  - Negative for helicobacter,- Intestinal metaplasia ,Oesophagus biopsies:- normal\n,Ileum and colon biopsies:- normal mucosa\n,Oesophagus, EMR 43P - Barrett 's oesophagus without intestinal metaplasia\n,Sigmoid colon, biopsy - Adenocarcinoma\n,- Chronic active inflammation,Duodenum biopsies:- normal mucosa\n,- Low grade dysplasia"</code></pre>
<p>If we apply the function NegativeRemove we see this changes to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MypathNegRem&lt;-<span class="kw"><a href="../reference/NegativeRemove.html">NegativeRemove</a></span>(Mypath,<span class="st">"Diagnosis"</span>)</code></pre></div>
<pre><code>## [1] ",Ileum and colon biopsies:- normal mucosa\n,Oesophagus, EMR 43P - Barrett 's oesophagus without intestinal metaplasia\n,Sigmoid colon, biopsy - Adenocarcinoma\n,- Chronic active inflammation,Duodenum biopsies:- normal mucosa\n,- Low grade dysplasia"</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#aims-of-endominer">Aims of EndoMineR</a></li>
      <li><a href="#how-is-the-package-divided">How is the package divided?</a></li>
      <li><a href="#the-extractor-function">The extractor function</a></li>
      <li><a href="#endoscopic-cleaning">Endoscopic cleaning</a></li>
      <li><a href="#histological-cleaning">Histological cleaning</a></li>
      <li><a href="#removal-of-negatives">Removal of negatives</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sebastian Zeki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
