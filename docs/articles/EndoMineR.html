<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EndoMineR • EndoMineR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">EndoMineR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/EndoMineR.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Analysis.html">Analysis</a>
    </li>
    <li>
      <a href="../articles/Barretts.html">Barrett's Oesophagus</a>
    </li>
    <li>
      <a href="../articles/EndoMineRPrinciples.html">EndoMinerPrinciples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>EndoMineR</h1>
                        <h4 class="author">Sebastian Zeki 2017-12-22</h4>
            
          </div>

    
    
<div class="contents">
<div id="aims-of-endominer" class="section level2">
<h2 class="hasAnchor">
<a href="#aims-of-endominer" class="anchor"></a>Aims of EndoMineR</h2>
<p>The goal of EndoMineR is to extract as much information as possible from endoscopy reports and their associated pathology specimens.</p>
<p>Gastroenterology now has many standards against which practice is measured although many reporting systems do not include the reporting capability to give anything more than basic analysis. Much of the data is locked in semi-structured text. However the nature of semi-structured text means that data can be extracted in a standardised way- it just requires more manipulation. This package provides that manipulation so that complex endoscopic-pathological analyses, in line with recognised standards for these analyses, can be done.</p>
</div>
<div id="how-is-the-package-divided" class="section level2">
<h2 class="hasAnchor">
<a href="#how-is-the-package-divided" class="anchor"></a>How is the package divided?</h2>
<div class="figure">
<img src="EndoMineR_FunctionStructure.svg" alt="Figure 2: Overview of all the functions" width="900"><p class="caption">Figure 2: Overview of all the functions</p>
</div>
<p>The package is basically in three parts. How all the functions are connected in Figure 2. Extracts from this figure will be used in sequential sections below.</p>
<ol style="list-style-type: decimal">
<li><p><strong>The extraction</strong>- This is really when the data is provided as full text reports. You may already have the data in a spreadsheet in which case this part isn’t necessary</p></li>
<li><p><strong>Cleaning</strong>- These are a group of functions that allow the user to extract and clean data commonly found in endoscopic and pathology reports. The cleaning functions usually remove common typos or extraneous information and do some reformatting</p></li>
<li><p><strong>Analyses</strong>- The analyses provide graphing function as well as analyses according to the cornerstone questions in gastroenterology- namely surveillance, patient tracking, quality of endoscopy and pathology reporting and diagnostic yield questions.</p></li>
</ol>
</div>
<div id="the-extractor-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-extractor-function" class="anchor"></a>The extractor function</h2>
<p>Endoscopic and pathological data will come in one of two forms- either as a collection of the whole text report or as spreadsheets with some degree of separation into different columns of the various aspects of that report eg who the Endoscopist was, the patient’s unique identifier etc. For the latter, the package user will not need to Extract information as it is already extracted and so can go straight to cleaning the data. For the former the Extractor function has been provided:</p>
<p><br></p>
<div class="figure">
<img src="EndoMineR_Extractor.svg" alt="Figure 3: Extractor function"><p class="caption">Figure 3: Extractor function</p>
</div>
<p><br></p>
<p>One of the most useful functions in the package is the Extractor. Different hospitals will use different software with different headings for endoscopic reports. The extractor allows the user to define the separations in a report so that all reports can be automatically placed into a meaningful dataframe for further cleaning. This is analogous to tokenization in natural language processing. Here we use the in built datasets as part of the package. Prior to tokenization it is recommended to use the ChopperNewLine function to divide the free text up by sentence (this can be useful if not using multiline regex or you have another way of splitting the text rather than using the Extractor)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/ChopperNewLines.html">ChopperNewLines</a></span>(Myendo,<span class="st">'OGDReportWhole'</span>)</code></pre></div>
<p><br></p>
<p>A list of keywords is then constructed. This list is made up of the words that will be used to split the document. The Extractor then does the splitting for each pair of words, with some cleaning up and then returns the split dataframe:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Mypath&lt;-<span class="kw">data</span>(PathDataFrameFinalColon)
HistolTree&lt;-<span class="kw">list</span>(<span class="st">"Hospital Number"</span>,<span class="st">"Patient Name"</span>,<span class="st">"DOB:"</span>,<span class="st">"General Practitioner:"</span>,
<span class="st">"Date of procedure:"</span>,<span class="st">"Clinical Details:"</span>,<span class="st">"Macroscopic description:"</span>,<span class="st">"Histology:"</span>,<span class="st">"Diagnosis:"</span>,<span class="st">""</span>)
for(i in <span class="dv">1</span>:(<span class="kw">length</span>(HistolTree)-<span class="dv">1</span>)) {
Mypath&lt;-<span class="kw">Extractor</span>(Mypath,<span class="st">"PathReportWhole"</span>,<span class="kw">as.character</span>(HistolTree[i]),
<span class="kw">as.character</span>(HistolTree[i<span class="dv">+1</span>]),<span class="kw">as.character</span>(HistolTree[i]))
}</code></pre></div>
</div>
<div id="the-cleaning-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#the-cleaning-functions" class="anchor"></a>The cleaning functions</h2>
<div id="endoscopic-cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#endoscopic-cleaning" class="anchor"></a>Endoscopic cleaning</h3>
<p>Once the extraction has been done there are various cleaning functions provided based around the extraction of likely columns. For example if the Endoscopist name has been pulled out, the EndoscChopperEndoscopist function can be used which returns the submitted data frame with the Endoscopist column cleaned up</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/EndoscChopperEndoscopist.html">EndoscChopperEndoscopist</a></span>(Myendo,<span class="st">'Endoscopist'</span>)</code></pre></div>
<p>This function performs the cleaning of common things found in the text that may cause confusion. The function itself is shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EndoscChopperEndoscopist &lt;-<span class="st"> </span>function(x, y) {
    <span class="co"># Extraction of the Endoscopist</span>
    x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x)
    x[, y] &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"Dr"</span>, <span class="st">""</span>, x[, y], <span class="dt">fixed =</span> <span class="ot">TRUE</span>)
    x[, y] &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"Mr"</span>, <span class="st">""</span>, x[, y], <span class="dt">fixed =</span> <span class="ot">TRUE</span>)
    x[, y] &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"[^[:alnum:],]"</span>, <span class="st">""</span>, x[, y])
    <span class="co"># Put gaps between names</span>
    x[, y] &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"([a-z])([A-Z])"</span>, <span class="st">"</span><span class="ch">\\</span><span class="st">1 </span><span class="ch">\\</span><span class="st">2"</span>, x[, y])
    x[, y] &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"2nd.*"</span>, <span class="st">""</span>, x[, y])
    x[, y] &lt;-<span class="st"> </span><span class="kw">trimws</span>(x[, y], <span class="dt">which =</span> <span class="kw">c</span>(<span class="st">"both"</span>))
    
    <span class="kw">return</span>(x)
}</code></pre></div>
<p><br></p>
<div class="figure">
<img src="EndoMineR_EndoscopyClean.svg" alt="Figure 4: Endoscopy Cleaning functions"><p class="caption">Figure 4: Endoscopy Cleaning functions</p>
</div>
<p><br></p>
<p>The EndoscChopperMeds currently extracts Fentanyl and Midazolam doses into a separate column and reformats them as numeric columns so further calculations can be done. In future iterations pethidine, propofol and general anaesthetic will also be able to be extracted.</p>
<p>Several other similar clean up functions are available for Endoscopy as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/EndoscChopperMeds.html">EndoscChopperMeds</a></span>(Myendo,<span class="st">'Medications'</span>)
v&lt;-<span class="kw"><a href="../reference/EndoscChopperInstrument.html">EndoscChopperInstrument</a></span>(Myendo,<span class="st">'Instrument'</span>)
v&lt;-<span class="kw"><a href="../reference/EndoscChopperIndications.html">EndoscChopperIndications</a></span>(Myendo,<span class="st">'Indications'</span>)
v&lt;-<span class="kw"><a href="../reference/EndoscChopperProcPerformed.html">EndoscChopperProcPerformed</a></span>(Myendo,<span class="st">'ProcedurePerformed'</span>)</code></pre></div>
<p>Future iterations will try to make these cleaning functions more generic and applicable to a wider number of use cases</p>
</div>
<div id="histological-cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#histological-cleaning" class="anchor"></a>Histological cleaning</h3>
<p>The cleaning functions for histology are a little more difficult as Histology reports often have a greater degree of free text reporting. In general, each histology reports can be divided into the Macroscopic description of a specimen which itself is comprised of how many specimens there are for each sample sent (a sample can be a pot which includes several specimens) and how big each specimen is. The report will often give a detailed description of what is actually seen and then provide an overall diagnosis.</p>
<p><br></p>
<div class="figure">
<img src="EndoMineR_HistopExtrapol.svg" alt="Figure 5: Histopathology Cleaning functions"><p class="caption">Figure 5: Histopathology Cleaning functions</p>
</div>
<p><br></p>
<p>The histology cleaning functions are based around this. For example, the HistolChopperHistol cleans the Histology text if present. In addition it removes Negative diagnoses using the Negativeremove function. This function is designed to remove all sentences that give negative diagnoses (eg “There is no evidence of…”) so that false positive diagnoses are not made during the analysis stage.</p>
<p>This NegativeRemove function has also been applied to the HistolChopperDx</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t&lt;-<span class="kw"><a href="../reference/HistolChopperHistol.html">HistolChopperHistol</a></span>(Mypath,<span class="st">'Histology'</span>)</code></pre></div>
<p>Because the information from the Macroscopic Description is based around numbers, a further function has been provided to extract numbers from the text. This function is usually only used as part of HistolChopperNumOfBx which extracts the number of biopsies taken:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HistolChopperNumbOfBx &lt;-<span class="st"> </span>function(x, y, z) {
    x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x)
    x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/HistolChopperMacDescrip.html">HistolChopperMacDescrip</a></span>(x, y)
    mylist &lt;-<span class="st"> </span><span class="kw">str_match_all</span>(x[, y], <span class="kw">paste</span>(<span class="st">"[0-9]{1,2}.{0,3}"</span>, z, <span class="dt">sep =</span> <span class="st">""</span>))
    x$NumbOfBx &lt;-<span class="st"> </span><span class="kw">sapply</span>(mylist, function(p) <span class="kw">sum</span>(<span class="kw">as.numeric</span>(<span class="kw">gsub</span>(z, <span class="st">""</span>, p))))
    <span class="kw">return</span>(x)
}</code></pre></div>
<p>In order to extract the numbers, the limit of what has to be extracted has to be set as part of the regex so that the function takes whatever word limits the selection.It collects everything from the regex [0-9]{1,2}.{0,3} to whatever the string boundary is.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/HistolChopperNumbOfBx.html">HistolChopperNumbOfBx</a></span>(Mypath,<span class="st">'Macroscopicdescription'</span>,<span class="st">'specimen'</span>)</code></pre></div>
<p>Other less useful functions include:</p>
<ol style="list-style-type: decimal">
<li><p>HistolChopperAccessionNumber which extracts Accession Number data from the report where one is present.The Accession number relates to the actual specimen number as ascribed by the pathology service.</p></li>
<li><p>HistolChopperExtrapolDx which extracts other specific diagnoses from the report. These have been hard coded to look for dysplasia cancer and GIST.</p></li>
<li><p>HistolChopperMacDescripCleanup. This extracts Macroscopic description data from the pathology report.Macroscopic description usually relates to the number of specimens retrieved, the size of each specimen and the location it was taken from. The cleanup usually relates to the removal of top and tail characters such as who reported the specimens etc.</p></li>
</ol>
<p>These are all called in the same way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/HistolChopperMacDescripCleanup.html">HistolChopperMacDescripCleanup</a></span>(Mypath,<span class="st">"Macroscopicdescription"</span>)
v&lt;-<span class="kw"><a href="../reference/HistolChopperExtrapolDx.html">HistolChopperExtrapolDx</a></span>(Mypath,<span class="st">"Diagnosis"</span>)
v&lt;-<span class="kw"><a href="../reference/HistolChopperAccessionNumber.html">HistolChopperAccessionNumber</a></span>(Mypath,<span class="st">"Histology"</span>,<span class="st">"SP-</span><span class="ch">\\</span><span class="st">d{2}-</span><span class="ch">\\</span><span class="st">d{7}"</span>)</code></pre></div>
<p>v&lt;-HistolChopperMacDescripCleanup(Mypath,“Macroscopicdescription”)</p>
<p><br><br></p>
</div>
</div>
<div id="the-analysis-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#the-analysis-functions" class="anchor"></a>The Analysis Functions</h2>
<p>As per the introduction the analysis functions are split according to the cornerstone questions in day to day gastroenterological practice</p>
<div id="surveillance-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#surveillance-functions" class="anchor"></a>Surveillance functions</h3>
<p>Surveillance relates to the timing of a test relative to other tests or all tests done for a patient. As such the functions for surveillance extract the date the first test was done, as well as the last test and the difference in timing between each test, always grouped by patient. As all these functions are simply looking at the date of the test they can take a raw dataset, as long as a date column is present and use that, rather than have a load of pre-processing steps</p>
<p><br></p>
<div class="figure">
<img src="EndoMineR_Surveillance.svg" alt="Figure 6: Surveillance functions"><p class="caption">Figure 6: Surveillance functions</p>
</div>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em&lt;-<span class="kw"><a href="../reference/SurveillanceTimeByRow.html">SurveillanceTimeByRow</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)
em&lt;-<span class="kw"><a href="../reference/SurveillanceLastToNow.html">SurveillanceLastToNow</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)
em&lt;-<span class="kw"><a href="../reference/SurveillanceLastTest.html">SurveillanceLastTest</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)
em&lt;-<span class="kw"><a href="../reference/SurveillanceFirstTest.html">SurveillanceFirstTest</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>)</code></pre></div>
<p>Of course we also want to know how many tests have been done over a time period and this is provided by two functions</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em&lt;-<span class="kw"><a href="../reference/SurveillanceCapacity.html">SurveillanceCapacity</a></span>(Myendo,<span class="st">"Dateofprocedure)</span></code></pre></div>
<p>This function will return the number of tests by month. The more detailed function is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">how&lt;-<span class="kw"><a href="../reference/HowManyTests.html">HowManyTests</a></span>(Myendo,<span class="st">'Indications'</span>,<span class="st">'Dateofprocedure'</span>,<span class="st">'Surv'</span>)</code></pre></div>
<p>This will provide the number of tests by month and year as a table as well as a ggplot. It returns aa list so this can be accessed with how[1] and how[2]</p>
</div>
<div id="patient-flow-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#patient-flow-functions" class="anchor"></a>Patient flow functions</h3>
<p>We often like to get an overview of how patients are flowing through a system overall. This can give a nice visual representation of whether which patients diverge from the normal flow through a system so we can study them further. There are two ways to look at this. Sankey plots give good timepoint by timepoint representation of flow. This really works with more than one type of event at each timepoint. For example, if we have a dataset with events such as ‘radiofrequency ablation’ and ‘endoscopic mucosal resection’ or ‘nothing’ we can use the Sankey plot to determine the order of events over a large patient population:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">how&lt;-<span class="kw"><a href="../reference/SurveySankey.html">SurveySankey</a></span>(Myendo,<span class="st">"ProcPerformed"</span>)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="EndoMineR_Sankey.svg" alt="Figure 7: SurveySankey function" width="600"><p class="caption">Figure 7: SurveySankey function</p>
</div>
<p><br></p>
<p>We may was something even more aggregated. Perhaps we want to see the overall number of patients that go from one event to another regardless of which timepoint it is at. To do this we can use a circos plot, which makes use of the circlize library, as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flow&lt;-<span class="kw"><a href="../reference/PatientFlow_CircosPlots.html">PatientFlow_CircosPlots</a></span>(v,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>,<span class="st">"ProcedurePerformed"</span>)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="EndoMineR_Circos.svg" alt="Figure 8: Circos function" width="600"><p class="caption">Figure 8: Circos function</p>
</div>
<p><br></p>
</div>
<div id="assessment-of-quality-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#assessment-of-quality-functions" class="anchor"></a>Assessment of quality functions</h3>
<p>Quality is measured in a variety of different ways. For endoscopy it is measured according to the adherence to standards for endoscopic documentation as well as detection of certain pathological conditions such as dysplasia.</p>
<div id="documentation-quality" class="section level4">
<h4 class="hasAnchor">
<a href="#documentation-quality" class="anchor"></a>Documentation Quality</h4>
<p>As regards adherence to documentation for example, a generic function is provided that will look up the presence of words presented in a list in a target column. It will then output the proportion of reports that have these words, as well as a barchart to show what proportion of the endoscopies showed these words. The list can be comprised on terms that should be mentioned in a report.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tt&lt;-<span class="kw"><a href="../reference/ListLookup.html">ListLookup</a></span>(Myendo,<span class="st">'Findings'</span>,myNotableWords)</code></pre></div>
</div>
<div id="endoscopic-quality" class="section level4">
<h4 class="hasAnchor">
<a href="#endoscopic-quality" class="anchor"></a>Endoscopic Quality</h4>
<p>Another measure of quality is by looking at those factors that are recorded at endoscopy such as degree of sedation used etc. Rather than provide a function for each metric, again a generic function is provided that uses any quantifiable metric and plots it against the endoscopist. This function returns a list with two elements- the plot and the table</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Myendo&lt;-<span class="kw"><a href="../reference/EndoscChopperMeds.html">EndoscChopperMeds</a></span>(Myendo,<span class="st">'Medications'</span>)
<span class="kw"><a href="../reference/MetricByEndoscopist.html">MetricByEndoscopist</a></span>(Myendo,<span class="st">'Endoscopist'</span>,<span class="st">'Fent'</span>)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="MetricByEndoscopist.png" alt="Figure 9: MetricbyEndoscopist function" width="600"><p class="caption">Figure 9: MetricbyEndoscopist function</p>
</div>
<p><br></p>
<p>Although not strictly a measure of endoscopic quality, the location of polyps (as well as any sample location) can also be determined. This is particularly for lower GI endoscopy and can help determine whether, for example, the number of right sided polyps is lower than it should be for certain endoscopists.</p>
<p>To do this firstly the free text needs to be standardised. This is provided through the function TermStandardLocation which provides a standard correction for a number of typos and alternative spellings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f&lt;-<span class="kw"><a href="../reference/TermStandardLocation.html">TermStandardLocation</a></span>(Mypath,<span class="st">'Histology'</span>)</code></pre></div>
<p>Once this is done, a column called SampleLocation is appended to the existing dataset. If polyps need to be located then the PolypLocator function can be used. Alternatively the SampleLocator can be used. As they append differently named columns to the existing dataset, both can be used together. The polyps text often need a bit of tidying up and this can be done with the function PolypTidyUpLocator prior to using PolypLocator</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f&lt;-<span class="kw"><a href="../reference/PolypTidyUpLocator.html">PolypTidyUpLocator</a></span>(f,<span class="st">'SampleLocation'</span>)
f&lt;-<span class="kw"><a href="../reference/PolypLocator.html">PolypLocator</a></span>(f,<span class="st">'SampleLocation'</span>) 
f&lt;-<span class="kw"><a href="../reference/SampleLocator.html">SampleLocator</a></span>(f,<span class="st">'SampleLocation'</span>)</code></pre></div>
<p>A further difficult area is the assessment of endoscopic quality by looking at the pathology processed from an endoscopy. This package is excellent at dealing with this kind of question because of its ability to merge the datasets together:</p>
<p>A particularly well developed area to look at is that of the Global Rating Scale for assessing the quality of colonoscopy. One of the metrics- the adenoma detection rate assesses the number of colonoscopies where at least one adenoma was detected.</p>
<p>One function is provided to produce a table that gives the number of adenomas, adenocarcinomas and hyperplastic polyps (also as a ration to adenomas) by endoscopist therefore immediately fulfilling the GRS reqquirement for the ADR as well as provding further metrics alongside</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">GRSTable&lt;-<span class="kw"><a href="../reference/GRS_Type_Assess_By_Unit.html">GRS_Type_Assess_By_Unit</a></span>(v,<span class="st">'ProcedurePerformed'</span>,<span class="st">'Endoscopist'</span>,<span class="st">'Diagnosis'</span>,<span class="st">'Histology'</span>)</code></pre></div>
</div>
</div>
<div id="basic-surveillance-questions--who-is-undergoing-endoscopic-surveillance-and-who-should-we-be-surveying" class="section level3">
<h3 class="hasAnchor">
<a href="#basic-surveillance-questions--who-is-undergoing-endoscopic-surveillance-and-who-should-we-be-surveying" class="anchor"></a>Basic surveillance questions- who is undergoing endoscopic surveillance and who should we be surveying?</h3>
<div id="enrollment-rates-to-surveillance-programme" class="section level4">
<h4 class="hasAnchor">
<a href="#enrollment-rates-to-surveillance-programme" class="anchor"></a>Enrollment rates to surveillance programme</h4>
<p>So now this has been determined we can continue to some more advanced analyses. We can determine how many patients who underwent endoscopy for reasons that was not Barrett’s surveillance, and in whom Barrett’s oesophagus was found, have had further follow-up endoscopies ie what the enrollment to surveillance rate is in those who weren’t known to have Barrett’s when their endoscopy was performed.</p>
<p>This function graphs the patients who were not on surveillance programmes and sees how many then had an endoscopy. This should be run after the BarrettsDataAccord_Prague and BarrettsDataAccord_PathStage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Enroll&lt;-<span class="kw"><a href="../reference/BarrettsPatientTracking_Enrollment_Surveillance.html">BarrettsPatientTracking_Enrollment_Surveillance</a></span>(Myendo,<span class="st">'HospitalNumber'</span>,<span class="st">'Dateofprocedure'</span>,<span class="st">'Indications'</span>)</code></pre></div>
</div>
<div id="patients-undergoing-surveillance" class="section level4">
<h4 class="hasAnchor">
<a href="#patients-undergoing-surveillance" class="anchor"></a>Patients undergoing surveillance</h4>
<p>Perhaps we are also interested in how many patients fall under each follow-up category so we can plan how many Barrett’s surveillance endoscopies we are going to have to do. The function to do this gets the unique patient ID’s for each patient, for each rule. It lists the unique PatientIDs assocaited with a rule (‘Rule1’,‘Rule2’,‘Rule3’,‘NoRules’). This allows us to determine how many patients will need follow up at specific time intervals. This should be run after the BarrettsDataAccord_Prague and BarrettsDataAccord_PathStage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/Endomerge2.html">Endomerge2</a></span>(Myendo,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>,v,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>)
b1&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Prague.html">BarrettsDataAccord_Prague</a></span>(v,<span class="st">'Findings'</span>)
b2&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_PathStage.html">BarrettsDataAccord_PathStage</a></span>(b1,<span class="st">'Histology'</span>)
b3&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Event.html">BarrettsDataAccord_Event</a></span>(b2,<span class="st">'Histology'</span>,<span class="st">'ProcedurePerformed'</span>,<span class="st">'OGDReportWhole'</span>,<span class="st">'Findings'</span>)
b4&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_FUGroup.html">BarrettsDataAccord_FUGroup</a></span>(b3,<span class="st">'Findings'</span>)
<span class="kw">colnames</span>(b4)[<span class="kw">colnames</span>(b4) ==<span class="st"> 'pHospitalNum'</span>] &lt;-<span class="st"> 'HospitalNumber'</span>
Rule&lt;-<span class="kw"><a href="../reference/BarrettsPatientTracking_UniqueHospNum.html">BarrettsPatientTracking_UniqueHospNum</a></span>(b4,<span class="st">'Rule1'</span>,<span class="st">'HospitalNumber'</span>)</code></pre></div>
</div>
</div>
<div id="quality-assessment-in-barretts-surveillance" class="section level3">
<h3 class="hasAnchor">
<a href="#quality-assessment-in-barretts-surveillance" class="anchor"></a>Quality assessment in Barrett’s surveillance</h3>
<div id="quality-of-documentation-for-barretts-surveillance-endoscopies" class="section level4">
<h4 class="hasAnchor">
<a href="#quality-of-documentation-for-barretts-surveillance-endoscopies" class="anchor"></a>Quality of documentation for Barrett’s surveillance endoscopies</h4>
<p>As we have done above, we can also assess the documentation used in Barrett’s endoscopies. There are standards associated with the endoscopies that all endoscopists should adhere to. This function therefore assesses the Barrett’s documentation. This notes how many reports contain the mandatory report fields as specified in the BSG standards on Barrett’s endoscopic reporting. This should be run after the BarrettsDataAccord_Prague as assessment of the Prague score is a part of this assessment:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v&lt;-<span class="kw"><a href="../reference/Endomerge2.html">Endomerge2</a></span>(Myendo,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>,v,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>)
b&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_PathStage.html">BarrettsDataAccord_PathStage</a></span>(v,<span class="st">'Histology'</span>)
<span class="kw"><a href="../reference/BarrettsQuality_AnalysisDocumentation.html">BarrettsQuality_AnalysisDocumentation</a></span>(b,<span class="st">"Findings"</span>)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="Rplot.png" alt="Figure 11: Barretts documentation quality function" width="600"><p class="caption">Figure 11: Barretts documentation quality function</p>
</div>
<p><br></p>
</div>
<div id="quality-of-perfomance-of-barretts-surveillance-endoscopies-as-just-by-tissue-sampling" class="section level4">
<h4 class="hasAnchor">
<a href="#quality-of-perfomance-of-barretts-surveillance-endoscopies-as-just-by-tissue-sampling" class="anchor"></a>Quality of perfomance of Barrett’s surveillance endoscopies as just by tissue sampling</h4>
<p>One of the essential requirements to demonstrate adequate sampling of Barrett’s oesophagus during endoscopy is that the endoscopist should adhere to the ‘Seattle protocol’ for biopsies which is to take 4 equally spaced biopsies at 2cm intervals in the circumferential part of the oesophagus. Because the macroscopic description of the pathological specimen tells us how many samples are taken overall (and rarely how many at each level but this is usually not the case for a variety of reasons) we can determine the shortfall in the number of biopsies taken, per endoscopist. Again pre-processing the Barrett’s samples is pre-requisite.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Firstly relevant columns are extrapolated from the</span>
 <span class="co"># Mypath demo dataset. These functions are all part of Histology data</span>
 <span class="co"># cleaning as part of the package.</span>
 v&lt;-<span class="kw"><a href="../reference/HistolChopperDx.html">HistolChopperDx</a></span>(Mypath,<span class="st">'Diagnosis'</span>)
 v&lt;-<span class="kw"><a href="../reference/HistolChopperExtrapolDx.html">HistolChopperExtrapolDx</a></span>(v,<span class="st">'Diagnosis'</span>)
 v&lt;-<span class="kw"><a href="../reference/HistolChopperNumbOfBx.html">HistolChopperNumbOfBx</a></span>(v,<span class="st">'Macroscopicdescription'</span>,<span class="st">'specimen'</span>)
 v&lt;-<span class="kw"><a href="../reference/HistolChopperBxSize.html">HistolChopperBxSize</a></span>(v,<span class="st">'Macroscopicdescription'</span>)
 <span class="co"># The histology is then merged with the Endoscopy dataset. The merge occurs</span>
 <span class="co"># according to date and Hospital number</span>
 v&lt;-<span class="kw"><a href="../reference/Endomerge2.html">Endomerge2</a></span>(Myendo,<span class="st">'Dateofprocedure'</span>,<span class="st">'HospitalNumber'</span>,v,<span class="st">'Dateofprocedure'</span>,
 <span class="st">'HospitalNumber'</span>)
 <span class="co"># The function relies on the other Barrett's functions being run as well:</span>
 b1&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Prague.html">BarrettsDataAccord_Prague</a></span>(v,<span class="st">'Findings'</span>)
 b2&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_PathStage.html">BarrettsDataAccord_PathStage</a></span>(b1,<span class="st">'Histology'</span>)
 b3&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Event.html">BarrettsDataAccord_Event</a></span>(b2,<span class="st">'Histology'</span>,
 <span class="st">'ProcedurePerformed'</span>,<span class="st">'OGDReportWhole'</span>,<span class="st">'Findings'</span>)
 <span class="co"># The follow-up group depends on the histology and the Prague score for a</span>
 <span class="co"># patient so it takes the processed Barrett's data and then looks in the</span>
<span class="co"># Findings column for permutations of the Prague score.</span>
 b4&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_FUGroup.html">BarrettsDataAccord_FUGroup</a></span>(b3,<span class="st">'Findings'</span>)
 <span class="kw">colnames</span>(b4)[<span class="kw">colnames</span>(b4) ==<span class="st"> 'pHospitalNum'</span>] &lt;-<span class="st"> 'HospitalNumber'</span>
 <span class="co"># The number of average number of biopsies is then calculated and</span>
 <span class="co"># compared to the average Prague C score so that those who are taking</span>
 <span class="co"># too few biopsies can be determined</span>
 <span class="kw"><a href="../reference/BarrettsQuality_AnalysisBiopsyNumber.html">BarrettsQuality_AnalysisBiopsyNumber</a></span>(b4,<span class="st">'Date.x'</span>,<span class="st">'HospitalNumber'</span>,
                                      <span class="st">'Endoscopist'</span>)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="Barretts_Shortfall.png" alt="Figure 12: Barretts quality of biopsying function" width="600"><p class="caption">Figure 12: Barretts quality of biopsying function</p>
</div>
<p><br></p>
<p><br></p>
<p>This function will again return a list with a ggplot showing the shortfall per endoscopist as well as a table with the same values</p>
</div>
<div id="quality-of-perfomance-of-barretts-surveillance-endoscopies" class="section level4">
<h4 class="hasAnchor">
<a href="#quality-of-perfomance-of-barretts-surveillance-endoscopies" class="anchor"></a>Quality of perfomance of Barrett’s surveillance endoscopies</h4>
<p>As we discovered with some of the generic functions above, one way to determine quality of endoscopy is to assess the pathology of specimens taken at surveillance per year. This function outputs a plot which determines the the overall number of pathologies (low/high grade dysplasia and cancer) for patients on surveillance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Endomerge2.html">Endomerge2</a></span>(Myendo,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>,v,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>)
b1&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Prague.html">BarrettsDataAccord_Prague</a></span>(v,<span class="st">'Findings'</span>)
b2&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_PathStage.html">BarrettsDataAccord_PathStage</a></span>(b1,<span class="st">'Histology'</span>)
b3&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Event.html">BarrettsDataAccord_Event</a></span>(b2,<span class="st">'Histology'</span>,<span class="st">'ProcedurePerformed'</span>,<span class="st">'OGDReportWhole'</span>,<span class="st">'Findings'</span>)
b4&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_FUGroup.html">BarrettsDataAccord_FUGroup</a></span>(b3,<span class="st">'Findings'</span>)
<span class="kw">colnames</span>(b4)[<span class="kw">colnames</span>(b4) ==<span class="st"> 'pHospitalNum'</span>] &lt;-<span class="st"> 'HospitalNumber'</span>
<span class="kw"><a href="../reference/BarrettsSurveillance_PathDetection.html">BarrettsSurveillance_PathDetection</a></span>(b4,<span class="st">'Myplot'</span>)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="BarrettsEMR_By_Pathology.svg" alt="Figure 13: EMR by pathology grade" width="600"><p class="caption">Figure 13: EMR by pathology grade</p>
</div>
<p><br></p>
<p>This function provides a plot with absolute numbers of pathology detected. This of course doesn’t tell us the per endoscopist rate so a further function is provided which looks specifically at the detection of dysplasia by endoscopist as a function of the number of surveillance endoscopies done by that endoscopist. The output is provided as a table of proportions per endoscopist</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> v&lt;-<span class="kw"><a href="../reference/Endomerge2.html">Endomerge2</a></span>(Myendo,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>,v,<span class="st">"Dateofprocedure"</span>,<span class="st">"HospitalNumber"</span>)
b1&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Prague.html">BarrettsDataAccord_Prague</a></span>(v,<span class="st">'Findings'</span>)
b2&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_PathStage.html">BarrettsDataAccord_PathStage</a></span>(b1,<span class="st">'Histology'</span>)
b3&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_Event.html">BarrettsDataAccord_Event</a></span>(b2,<span class="st">'Histology'</span>,<span class="st">'ProcedurePerformed'</span>,<span class="st">'OGDReportWhole'</span>,<span class="st">'Findings'</span>)
b4&lt;-<span class="kw"><a href="../reference/BarrettsDataAccord_FUGroup.html">BarrettsDataAccord_FUGroup</a></span>(b3,<span class="st">'Findings'</span>)
<span class="kw">colnames</span>(b4)[<span class="kw">colnames</span>(b4) ==<span class="st"> 'pHospitalNum'</span>] &lt;-<span class="st"> 'HospitalNumber'</span>
<span class="kw"><a href="../reference/BarrettsSurveillanceDDR.html">BarrettsSurveillanceDDR</a></span>(b4,<span class="st">'Endoscopist'</span>,<span class="st">'IMorNoIM'</span>)</code></pre></div>
</div>
</div>
<div id="assessment-of-barretts-therapeutics" class="section level3">
<h3 class="hasAnchor">
<a href="#assessment-of-barretts-therapeutics" class="anchor"></a>Assessment of Barrett’s therapeutics</h3>
<p>Barrett’s patients also undergo therapeutic procedures and there are various metrics to analyse the performance of the therapy by endoscopist, as well which catheters are being used etc. To start with we can do simple things like plotting all the pathological grades of the EMRs.This should only be run after all the BarrettsDataAccord functions so that the column event is present in the dataframe.</p>
<p>The therapeutic functions are fairly self-explanatory. The function to determine the post EMR grade is BarrettsTherapy_Numbers_EMRsByGrade with correlation with the endoscopists Paris classification provided for with the function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Barretts_LesionRecognitionEMR.html">Barretts_LesionRecognitionEMR</a></span>(dataframe,y,z)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="GradeBarretts.svg" alt="Figure 14: Worst grade dysplasia/cancer function" width="600"><p class="caption">Figure 14: Worst grade dysplasia/cancer function</p>
</div>
<p><br></p>
<p>In order to determine the basic number of EMR, RFA and APC a function called BarrettsBasicNumbers is provided which outputs a geom_line plot with the information on it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/BarrettsBasicNumbers.html">BarrettsBasicNumbers</a></span>(dataframe)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="BarrettsBasicNumbers.svg" alt="Figure 15: Number of Barrett’s therapeutic endoscopies by type" width="600"><p class="caption">Figure 15: Number of Barrett’s therapeutic endoscopies by type</p>
</div>
<p><br></p>
<p>To assess the number of different catheter types used (for renumeration purposes) the following function can be used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/BarrettsTherapeuticsRFA_ByCatheter.html">BarrettsTherapeuticsRFA_ByCatheter</a></span>(dataframe)</code></pre></div>
<p><br></p>
<div class="figure">
<img src="BarrettsRFA_CatheterType.svg" alt="Figure 16: Number of Barrett’s therapeutic endoscopies by type" width="600"><p class="caption">Figure 16: Number of Barrett’s therapeutic endoscopies by type</p>
</div>
<p><br></p>
<p>One of the most important aspects of therapeutics is the assessment of outcome which is defined as clearance of intestinal metaplasia (CRIM), usually on at least two endoscopies. As most patients undergoing Barrett’s ablation will require radiofrequency ablation after the initial endoscopic mucosal resection, we can define CRIM as being an endoscopy where the therapeutic procedure is listed as ‘nothing’ in the EVENT column (this will only work if the Barrett’s pre-processing functions have been used)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">BarrettsCRIM</span>(dataframe,HospNum,EVENT)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#aims-of-endominer">Aims of EndoMineR</a></li>
      <li><a href="#how-is-the-package-divided">How is the package divided?</a></li>
      <li><a href="#the-extractor-function">The extractor function</a></li>
      <li><a href="#the-cleaning-functions">The cleaning functions</a></li>
      <li><a href="#the-analysis-functions">The Analysis Functions</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sebastian Zeki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
